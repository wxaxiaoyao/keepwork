{"version":3,"sources":["webpack:///webpack/bootstrap 20013ea1821c6625e692","webpack:///external \"lodash\"","webpack:///./server/config.js","webpack:///./~/babel-runtime/regenerator/index.js","webpack:///./server/common/error.js","webpack:///external \"joi\"","webpack:///external \"sequelize\"","webpack:///external \"koa\"","webpack:///./common/api/gitlab.js","webpack:///./server/models/dataSource.js","webpack:///./server/models/database.js","webpack:///./server/models/user.js","webpack:///external \"jwt-simple\"","webpack:///external \"wurl\"","webpack:///./nuxt.config.js","webpack:///./server/server.js","webpack:///external \"nuxt\"","webpack:///./common/api/elasticSearch.js","webpack:///./common/config.js","webpack:///./server/controllers/dataSource.js","webpack:///./server/controllers/gitlab.js","webpack:///./server/controllers/index.js","webpack:///./server/controllers/user.js","webpack:///./server/middlewares/index.js","webpack:///./server/middlewares/validate.js","webpack:///./server/models/index.js","webpack:///./server/prod.config.js","webpack:///external \"@koa/cors\"","webpack:///external \"elasticsearch\"","webpack:///external \"js-base64\"","webpack:///external \"js-yaml\"","webpack:///external \"koa-body\"","webpack:///external \"koa-jwt\"","webpack:///external \"koa-router\"","webpack:///external \"koa-session\"","webpack:///external \"node-gitlab-api\"","webpack:///external \"regenerator-runtime\"","webpack:///./server/index.js"],"names":["defaultConfig","gitlabToken","secret","database","host","type","username","password","productionConfig","developmentConfig","configs","Err","code","message","data","prototype","setMessage","setCode","setData","ERR","ERR_OK","ERR_PARAMS","ERR_UNATUH","ERR_NOT_FOUND","defaultUsername","apiBaseUrl","rawBaseUrl","token","ref","branch","projectId","xiaoyaoConfig","externalUsername","projectName","keepworkConfig","gitlab","gits","encodeUrl","url","encodeURIComponent","replace","getUsernameByPath","path","paths","split","i","length","Gitlab","config","_","mapKeys","value","key","camelCase","cfg","api","getFile","RepositoryFiles","show","then","file","content","Base64","decode","getContent","upsertFile","options","editFile","createFile","edit","create","removeFile","remove","getTree","Repositories","tree","getFileGitUrl","initConfig","getGitByPath","git","gitlabFactory","DataSource","sequelize","define","id","Sequelize","BIGINT","autoIncrement","primaryKey","STRING","allowNull","name","unique","externalUserId","externalPassword","isDefault","BOOLEAN","dbconfig","dialect","operatorsAliases","pool","max","min","acquire","idle","User","set","val","setDataValue","toUpperCase","email","cellphone","nickname","portrait","sex","module","exports","srcDir","env","HOST","PORT","router","plugins","src","ssr","head","title","meta","charset","hid","link","rel","href","css","loading","color","build","vendor","extend","ctx","resolve","alias","node","fs","tls","net","apiRouter","prefix","apiUrlPrefix","registerControllerRouter","app","views","viewRouter","use","cors","KoaBody","jwt","passthrough","cookie","seesion","signed","routes","allowedMethods","client","elasticsearch","Client","elasticsearchFactory","urlPrefix","pageSuffix","tagModsPath","port","defaultDataSource","model","update","delete","find","getSystemDataSource","cloneDeep","getDefaultDataSource","params","request","query","authUsername","state","user","findOne","where","dataSource","get","plain","undefined","getRoutes","method","action","getGitData","JSON","parse","console","log","formatSiteinfoESData","formatUserinfoESData","formatPageinfoESData","formatESDataMap","getGitFileData","yaml","safeLoad","json","e","formatESData","tablename","format","submitESData","item","indexs","index_prefix","version","esData","index","join","body","res","esClient","webhook","self","commit","commits","project_url","project","http_url","origin","wurl","gitcfg","project_id","external_username","user_username","filelist","dataFileReg","filelistAddItem","oper","test","match","push","each","added","modified","removed","promises","Promise","all","controllers","ctrl","route","methods","isArray","lowerCase","validate","next","requireAuth","status","register","encode","userId","_id","userinfo","login","isLogin","findById","joi","string","required","schema","opt","defaultsDeep","allowUnknown","defaultValidateKeys","needValidateKeys","intersection","Object","keys","errors","toValidateObj","result","error","details","assignIn","msg","require","dev","nuxt","builder","server","reject","on","req","render","promise","catch","_config","listen","start"],"mappings":"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","file":"main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 36);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 20013ea1821c6625e692","module.exports = require(\"lodash\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash\"\n// module id = 0\n// module chunks = 0","import commonConfig from \"../common/config.js\";\nimport config from \"./prod.config.js\";\n\nconst defaultConfig = {\n\t...commonConfig,\n\n\tgitlabToken: \"18ayouuEsKRo_yM1P5eF\",\n\n\tsecret: \"keepwork\",\n\n\tdatabase: {\n\t\t//port:3306,\n\t\thost: '39.106.11.114',\n\t\ttype: \"mysql\",\n\t\tdatabase: \"keepwork\", // 数据库名\n\t\tusername: \"wuxiangan\",\n\t\tpassword: \"xxxxxx\", \n\t},\n}\n\nconst productionConfig = {\n\t...defaultConfig,\n\t\n\t...config,\n}\n\nconst developmentConfig = {\n\t...defaultConfig,\n\n\t...config,\n}\n\nconst configs = {\n\t\"production\": productionConfig,\n\t\"development\": developmentConfig,\n}\n\nexport default configs[process.env.NODE_ENV];\n\n\n\n// WEBPACK FOOTER //\n// ./server/config.js","module.exports = require(\"regenerator-runtime\");\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/babel-runtime/regenerator/index.js\n// module id = 2\n// module chunks = 0","\nexport const Err = function(code, message, data) {\n\tthis.code = code || 0;\n\tthis.message = message || \"OK\";\n\tthis.data = data || null; // 请求数据\n}\n\nErr.prototype.setMessage = function(message = \"OK\"){\n\tthis.message = message;\n\treturn this;\n}\n\nErr.prototype.setCode = function(code = 0){\n\tthis.code = code; \n\treturn this;\n}\n\nErr.prototype.setData = function(data){\n\tthis.data = data;\n\treturn this;\n}\n\nexport const ERR = new Err(-1, \"unknown error\");\nexport const ERR_OK = new Err();\nexport const ERR_PARAMS = new Err(1, \"参数错误\");\nexport const ERR_UNATUH = new Err(2, \"未认证\");\nexport const ERR_NOT_FOUND = new Err(3, \"未找到记录\");\n\nexport default {\n\tERR,\n\tERR_OK,\n\tERR_PARAMS,\n\tERR_UNATUH,\n\tERR_NOT_FOUND,\n};\n\n\n\n\n\n\n\n// WEBPACK FOOTER //\n// ./server/common/error.js","module.exports = require(\"joi\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"joi\"\n// module id = 4\n// module chunks = 0","module.exports = require(\"sequelize\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"sequelize\"\n// module id = 5\n// module chunks = 0","module.exports = require(\"koa\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa\"\n// module id = 6\n// module chunks = 0","import gitlabApi from \"node-gitlab-api\";\nimport {Base64} from \"js-base64\";\nimport _ from \"lodash\";\n\nconst defaultUsername = \"keepwork\";\n\nconst defaultConfig = {\n\tapiBaseUrl:\"https://gitlab.com\",\n\trawBaseUrl:\"https://gitlab.com\",\n\ttoken:\"Ed9S7hSfiruewMR-jitR\",\n\tref:\"master\",\n\tbranch:\"master\",\n\tprojectId:4980659,\n\t//rootPath:\"xiaoyao\",\n};\n\nconst xiaoyaoConfig = {\n\tusername:\"xiaoyao\",\n\tprojectId: 4980659,\n\texternalUsername: \"wxaxiaoyao\",\n\tprojectName: \"keepworkdatasource\",\n\ttoken:\"Ed9S7hSfiruewMR-jitR\",\n\tref: \"master\",\n\tbranch: \"master\",\n}\n\nconst keepworkConfig = {\n\tusername:\"keepwork\",\n\texternalUsername: \"keepwork\",\n\tprojectName: \"keepworkdatasource\",\n\thost:\"https://gitlab.com\",\n\ttoken:\"9x94xLa-CZPH9Da5h5kd\",\n\tref:\"master\",\n\tbranch: \"master\",\n\tprojectId:5112836,\n}\n\nconst gitlab = {\n\tgits:{\n\n\t}\n}\n\nconst encodeUrl = function(url) {\n\treturn encodeURIComponent(url).replace(/\\./g,'%2E')\n}\n\nconst getUsernameByPath = function(path) {\n\tconst paths = (path || \"\").split(\"/\");\n\tlet username = \"keepwork\";\n\tfor (let i = 0; i < paths.length; i++) {\n\t\tif (paths[i]) {\n\t\t\tusername = paths[i];\n\t\t\tbreak;\n\t\t}\n\t}\n\n\tusername = username.replace(/_(data|files)$/, \"\");\n\n\treturn username;\n}\n\nfunction Gitlab(config){\n\tconfig = _.mapKeys(config || {}, (value, key) => _.camelCase(key));\n\tthis.cfg = {\n\t\t...defaultConfig,\n\t\t...((gitlab.gits[config.username] || {}).cfg || {}),\n\t\t...(config || {}),\n\t};\n\t//console.log(cfg);\n\t\n\tthis.api = new gitlabApi({url:this.cfg.rawBaseUrl, token:this.cfg.token});\n\t//return this;\n}\n\nGitlab.prototype.getFile = function(path) {\n\treturn this.api.RepositoryFiles.show(this.cfg.projectId, path, this.cfg.ref).then(file => {\n\t\tfile.content = Base64.decode(file.content);\n\t\treturn file;\n\t});\n}\n\nGitlab.prototype.getContent = function(path) {\n\treturn this.api.RepositoryFiles.show(this.cfg.projectId, path, this.cfg.ref).then(file => Base64.decode(file.content));\n}\n\nGitlab.prototype.upsertFile = function(path, options) {\n\tconst file = this.getFile(path);\n\treturn file ? this.editFile(path, options) : this.createFile(path, options);\n}\n\nGitlab.prototype.editFile = function(path, options) {\n\treturn this.api.RepositoryFiles.edit(this.cfg.projectId, path, this.cfg.branch, options);\n}\n\nGitlab.prototype.createFile = function(path, options) {\n\treturn this.api.RepositoryFiles.create(this.cfg.projectId, path, this.cfg.branch, options);\n}\n\nGitlab.prototype.removeFile = function(path, options) {\n\treturn this.api.RepositoryFiles.remove(this.cfg.projectId, path, this.cfg.branch, options);\n}\n\nGitlab.prototype.getTree = function(path, options) {\n\toptions = options || {};\n\toptions.path = path;\n\n\treturn this.api.Repositories.tree(this.cfg.projectId, options);\n}\n\nGitlab.prototype.getFileGitUrl = function(path) {\n\tconst url = this.cfg.rawBaseUrl + \"/\" + this.cfg.externalUsername + \"/\" + this.cfg.projectName + '/blob/' + \"master\" + '/' + path;\n\t\n\treturn url;\n}\n\ngitlab.initConfig = function(config){\n\tif (!config || !config.username) {\n\t\treturn;\n\t}\n\t\n\tthis.gits[config.username] = new Gitlab(config);\n}\n\ngitlab.getGitByPath = function(path) {\n\tconst username = getUsernameByPath(path);\n\treturn this.gits[username] || this.gits[defaultUsername];\n}\n\ngitlab.getContent = function(path) {\n\treturn this.getGitByPath(path).getContent(path);\n}\n\ngitlab.getFile = function(path) {\n\treturn this.getGitByPath(path).getFile(path);\n}\n\ngitlab.editFile = function(path, options) {\n\tconst git = this.getGitByPath(path);\n\treturn git.editFile(path, options);\n}\n\ngitlab.createFile = function(path, options) {\n\tconst git = this.getGitByPath(path);\n\t//path = encodeUrl(path);\n\treturn git.createFile(path, options);\n}\n\ngitlab.removeFile = function(path, options) {\n\tconst git = this.getGitByPath(path);\n\treturn git.removeFile(path, options);\n}\n\ngitlab.getTree = function(path, options) {\n\tconst git = this.getGitByPath(path);\n\treturn git.getTree(path, options);\n}\n\ngitlab.getFileGitUrl = function(path) {\n\treturn this.getGitByPath(path).getFileGitUrl(path);\n}\n\ngitlab.initConfig(keepworkConfig);\ngitlab.initConfig(xiaoyaoConfig);\n\nexport const gitlabFactory = (config) => new Gitlab(config);\nexport default gitlab;\n\n\n\n// WEBPACK FOOTER //\n// ./common/api/gitlab.js","import Sequelize from 'sequelize';\nimport sequelize from \"./database.js\";\n\nconst DataSource = sequelize.define(\"dataSource\", {\n\tid: {\n\t\ttype: Sequelize.BIGINT,\n\t\tautoIncrement: true,\n\t\tprimaryKey: true,\n\t},\n\n\tusername: {\n\t\ttype: Sequelize.STRING(48),\n\t\tallowNull: false,\n\t},\n\n\tname: {\n\t\ttype: Sequelize.STRING(48),\n\t\tunique: true,\n\t},\n\n\ttype: {\n\t\ttype: Sequelize.STRING(12),\n\t},\n\n\ttoken: {\n\t\ttype: Sequelize.STRING(128),\n\t\t//allowNull, false,\n\t},\n\n\tapiBaseUrl: {\n\t\ttype: Sequelize.STRING(64),\n\t},\n\n\trawBaseUrl: {\n\t\ttype: Sequelize.STRING(64),\n\t},\n\n\texternalUserId: {\n\t\ttype: Sequelize.BIGINT,\n\t},\n\n\texternalUsername: {\n\t\ttype: Sequelize.STRING(48),\n\t},\n\n\texternalPassword: {\n\t\ttype: Sequelize.STRING(128),\n\t},\n\t\n\tisDefault: {\n\t\ttype: Sequelize.BOOLEAN,\n\t},\n});\n\n//DataSource.sync({force:true}).then(() => {\n\t//console.log(\"create dataSource table successfully\");\n//});\n\nexport default DataSource;\n\n\n\n// WEBPACK FOOTER //\n// ./server/models/dataSource.js","import Sequelize from 'sequelize';\nimport config from \"../config.js\";\n\nconst dbconfig = config.database;\n\nconst sequelize = new Sequelize(dbconfig.database, dbconfig.username, dbconfig.password, {\n  host: dbconfig.host,\n  dialect: dbconfig.type,\n  operatorsAliases: false,\n\n  pool: {\n    max: 5,\n    min: 0,\n    acquire: 30000,\n    idle: 10000\n  },\n\n  // SQLite only\n  //storage: 'path/to/database.sqlite'\n});\n\n//sequelize\n  //.authenticate()\n  //.then(() => {\n    //console.log('Connection has been established successfully.');\n  //})\n  //.catch(err => {\n    //console.error('Unable to connect to the database:', err);\n  //});\n\nexport default sequelize;\n\n\n\n// WEBPACK FOOTER //\n// ./server/models/database.js","import Sequelize from 'sequelize';\nimport sequelize from \"./database.js\";\n\nconst User = sequelize.define('user', {\n\tid: {\n\t\ttype: Sequelize.BIGINT,\n\t\tautoIncrement: true,\n\t\tprimaryKey: true,\n\t},\n\t\n\tusername: {\n\t\ttype: Sequelize.STRING(48),\n\t\tunique: true,\n\t},\n\n\tpassword: {\n\t\ttype: Sequelize.STRING(48),\n\n\t\tset(val) {\n\t\t\tthis.setDataValue(\"password\", val.toUpperCase());\n\t\t},\n\t},\n\n\temail: {\n\t\ttype: Sequelize.STRING(24),\n\t\tunique: true,\n\t},\n\n\tcellphone: {\n\t\ttype: Sequelize.STRING(24),\n\t\tunique: true,\n\t},\n\n\tnickname: {\n\t\ttype: Sequelize.STRING,\n\t},\n\n\tportrait: {\n\t\ttype: Sequelize.STRING,\n\t},\n\n\tsex: {\n\t\ttype: Sequelize.STRING(4),\n\t},\n});\n\n//User.sync({force:true}).then(() => {\n\t//console.log(\"create user table successfully\");\n//});\n\n\nexport default User;\n\n\n\n// WEBPACK FOOTER //\n// ./server/models/user.js","module.exports = require(\"jwt-simple\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"jwt-simple\"\n// module id = 11\n// module chunks = 0","module.exports = require(\"wurl\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"wurl\"\n// module id = 12\n// module chunks = 0","module.exports = {\n\tsrcDir: \"client/\",\n\tenv:{\n\t\t//NODE_ENV:\"development\",\n\t\tHOST: \"0.0.0.0\",\n\t\tPORT: 8088,\n\t},\n\n\trouter: {\n\t},\n\n\tplugins: [\n\t{src:\"~/plugins/element-ui\", ssr: false},\n\t{src:\"~/plugins/codemirror\", ssr: false},\n\t{src:\"~/plugins/persistedstate\", ssr: false},\n\t{src:\"~/plugins/app\", ssr: false},\n\t{src:\"~/plugins/test\", ssr: false},\n\t],\n\t/*\n\t** Headers of the page\n\t*/\n\thead: {\n\t\ttitle: 'starter',\n\t\tmeta: [\n\t\t{ charset: 'utf-8' },\n\t\t{ name: 'viewport', content: 'width=device-width, initial-scale=1' },\n\t\t{ hid: 'description', name: 'description', content: 'Nuxt.js project' }\n\t\t],\n\t\tlink: [\n\t\t{ rel: 'icon', type: 'image/x-icon', href: '/favicon.ico' }\n\t\t]\n\t},\n\n\t//babel: {\n\t\t//plugins: [\n\t\t\t//[\n\t\t\t\t//'component',\n\t\t\t\t//[\n\t\t\t\t//{\n\t\t\t\t//'libraryName': 'element-ui',\n\t\t\t\t//'styleLibraryName': 'theme-default'\n\t\t\t\t//},\n\t\t\t\t//'transform-async-to-generator',\n\t\t\t\t//'transform-runtime'\n\t\t\t\t//]\n\t\t\t//]\n\t\t//],\n\t\t//comments: false\n\t//},\n\t/*\n  \t** Global CSS\n  \t*/\n  \tcss: ['~assets/css/main.css'],\n  \t/*\n  \t** Customize the progress-bar color\n  \t*/\n  \tloading: { color: '#3B8070' },\n  \t/*\n  \t ** Build configuration\n  \t */\n  \tbuild: {\n\t\tvendor: [\n\t\t\t\"vue-template-compiler\",\n\t\t\t\"vuex-persistedstate\",\n\t\t\t\"axios\",\n\t\t\t\"lodash\",\n\t\t\t\"element-ui\",\n\t\t\t\"elasticsearch\",\n\t\t\t\"jshashes\",\n\t\t\t\"js-base64\",\n\t\t\t\"js-cookie\",\n\t\t\t\"jss\",\n\t\t\t\"jss-preset-default\",\n\t\t\t\"node-gitlab-api\",\n\t\t\t\"codemirror\",\n\t\t\t\"vue-codemirror\",\n\t\t],\n\t\t/*\n  \t  \t ** Run ESLINT on save\n  \t  \t */\n  \t  \textend (config, ctx) {\n  \t  \t  //if (ctx.isClient) {\n  \t  \t\t//config.module.rules.push({\n  \t  \t\t  //enforce: 'pre',\n  \t  \t\t  //test: /\\.(js|vue)$/,\n  \t  \t\t  //loader: 'eslint-loader',\n  \t  \t\t  //exclude: /(node_modules)/\n  \t  \t\t//})\n  \t  \t  //}\n\t\t\tconfig.resolve.alias = {\n\t\t\t\t...(config.resolve.alias || {}),\n\t\t\t\t\"@\":\"/mnt/d/workspace/lua/keepwork/kp/client/\",\n\t\t\t\t\"common\":\"/mnt/d/workspace/lua/keepwork/kp/common/\",\n\t\t\t\t'vue$':'vue/dist/vue.esm.js',\n\t\t\t},\n\t\t\tconfig.node = {\n\t\t\t\t...(config.node || {}),\n\t\t\t\tfs: \"empty\",\n\t\t\t\ttls: \"empty\",\n  \t  \t\t\tnet: \"empty\",\n  \t  \t\t};\n  \t  \t}\n  \t}\n}\n\n\n\n// WEBPACK FOOTER //\n// ./nuxt.config.js","import Koa from \"koa\";\nimport cors from \"@koa/cors\";\nimport jwt from \"koa-jwt\";\nimport seesion from \"koa-session\";\nimport Router from \"koa-router\";\nimport KoaBody from \"koa-body\";\nimport wurl from \"wurl\";\nimport _ from \"lodash\";\n\nimport registerControllerRouter from \"./controllers/index.js\";\n\n//import log from \"./log.js\";\nimport config from \"./config.js\";\nimport models from \"./models/index.js\";\n\nconst apiRouter = new Router({\n\tprefix: config.apiUrlPrefix,\n});\nregisterControllerRouter(apiRouter);\n\n\nexport default (app, views) => {\n\tconst viewRouter = new Router({});\n\t//viewRouter.get(\"/www/*\", views);\n\n\tapp\n\t.use(cors())\n\t.use(KoaBody())\n\t.use(jwt({secret:config.secret, passthrough:true, cookie:\"token\"}))\n\t.use(seesion({signed: false},app))\n\t.use(apiRouter.routes())\n\t.use(apiRouter.allowedMethods())\n\t.use(viewRouter.routes());\n}\n\n\n\n\n// WEBPACK FOOTER //\n// ./server/server.js","module.exports = require(\"nuxt\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"nuxt\"\n// module id = 15\n// module chunks = 0","\nimport elasticsearch from \"elasticsearch\";\n\nconst defaultConfig = {\n\thost: \"http://10.28.18.7:9200\",\n}\n\nconst client = new elasticsearch.Client({\n\t...defaultConfig,\n});\n\nexport const elasticsearchFactory = (config) => {\n\treturn new elasticsearch.Client({\n\t\t...defaultConfig,\n\t\t...(config || {}),\n\t});\n}\n\nexport default client;\n\n\n\n// WEBPACK FOOTER //\n// ./common/api/elasticSearch.js","\nconst config = {\n\turlPrefix: \"www\",\n\tapiUrlPrefix: \"/api/v0\",\n\tpageSuffix:\".md\",\n\ttagModsPath: \"keepwork_data/tag_mods.json\",\n\n\n\thost: \"0.0.0.0\",\n\tport: 8088,\n}\n\nexport default config;\n\n\n\n// WEBPACK FOOTER //\n// ./common/config.js","import _ from \"lodash\";\nimport joi from \"joi\";\nimport jwt from \"jwt-simple\";\n\nimport config from \"../config.js\";\nimport ERR from \"../common/error.js\";\nimport DataSourceModel from \"../models/dataSource.js\";\n\nconst defaultDataSource = {\n\tusername:\"keepwork\",\n\texternalUsername: \"keepwork\",\n\tprojectName: \"keepworkdatasource\",\n\thost:\"https://gitlab.com\",\n\ttoken:\"9x94xLa-CZPH9Da5h5kd\",\n\tref:\"master\",\n\tbranch: \"master\",\n\tprojectId:5112836,\n}\n\nexport const DataSource = function() {\n\tthis.model = DataSourceModel;\n}\n\nDataSource.prototype.create = function() {\n\n} \n\nDataSource.prototype.update = function() {\n\n}\n\nDataSource.prototype.delete = function() {\n\n}\n\nDataSource.prototype.find = function() {\n\n}\n\nDataSource.prototype.getSystemDataSource = function() {\n\treturn _.cloneDeep(defaultDataSource);\n}\n\n// 获取用户默认数据源\nDataSource.prototype.getDefaultDataSource = async function(ctx) {\n\tconst params = ctx.request.query;\n\tconst authUsername = ctx.state.user.username;\n\tconst username = params.username || authUsername;\n\n\tif (!username) return ERR.ERR_PARAMS;\n\t\n\tlet dataSource = await this.model.findOne({\n\t\twhere: {\n\t\t\tusername: username,\n\t\t\tisDefault: true,\n\t\t},\n\t});\n\n\tif (!dataSource) return ERR.ERR_NOT_FOUND;\n\n\tdataSource = dataSource.get({plain:true});\n\n\tif (username != authUsername) {\n\t\tdataSource.token = undefined;\n\t\tdataSource.externalPassword = undefined;\n\t}\n\n\treturn dataSource;\n}\n\nDataSource.prototype.getRoutes = function() {\n\tconst prefix = \"/dataSource\";\n\tconst routes = [\n\t{\n\t\tpath: prefix + \"/getDefaultDataSource\",\n\t\tmethod: \"get\",\n\t\taction: \"getDefaultDataSource\",\n\t},\n\t];\n\n\treturn routes;\n}\n\nexport default new DataSource();\n\n\n\n// WEBPACK FOOTER //\n// ./server/controllers/dataSource.js","import _ from \"lodash\";\nimport joi from \"joi\";\nimport wurl from \"wurl\";\nimport yaml from \"js-yaml\";\n\nimport ERR from \"../common/error.js\";\nimport config from \"../config.js\";\nimport esClient from \"../../common/api/elasticSearch.js\";\nimport {gitlabFactory} from \"../../common//api/gitlab.js\";\nimport gitlab from \"../../common/api/gitlab.js\";\n//import {gitlabFactory} from \"../../vue/src//api/gitlab.js\";\n\n// 获取GIT的ES数据\nconst getGitData = async function(git, path) {\n\ttry {\n\t\tconst content = await git.getContent(path);\n\t\tconst data = JSON.parse(content);\n\t\treturn data;\n\t} catch (e){\n\t\tconsole.log(e);\n\t}\n\treturn;\n} \n\nconst formatSiteinfoESData = function(data) {\n\n}\n\nconst formatUserinfoESData = function(data) {\n\n}\n\nconst formatPageinfoESData = function(data) {\n\n}\n\nconst formatESDataMap = {\n\t\"userinfo\": formatUserinfoESData,\n\t\"siteinfo\": formatSiteinfoESData,\n\t\"pageinfo\": formatPageinfoESData,\n}\n\nexport const Gitlab = function() {\n\t\n}\n\n// 获取git文件中的数据信息\nGitlab.prototype.getGitFileData = function(content) {\n\ttry {\n\t\t//return Json.parse(content);\n\t\treturn yaml.safeLoad(content, {json:true});\n\t} catch(e) {\n\t\tconsole.log(e);\n\t}\n\n\treturn ;\n}\n\nGitlab.prototype.formatESData = function(data, tablename) {\n\tdata = _.cloneDeep(data || {});\n\tconst format = formatESDataMap[tablename];\n\n\tformat && format(data);\n\n\treturn data;\n}\n\nGitlab.prototype.submitESData = async function(item) {\n\tconst data = item.data || {};\n\tconst tablename = item.tablename;\n\tconst path = item.path;\n\tconst action = item.action;\n\tconst indexs = [data.index_prefix || \"kw\", tablename, data.version || \"v0\"];\n\tconst esData = {\n\t\tindex: indexs.join(\"_\"),\n\t\ttype: tablename,\n\t\tid: path.replace(/\\//g, \"_\"),\n\t\tbody: data.data || {},\n\t}\n\tesData.body.path = path;\n\n\tlet res = null;\n\ttry {\n\t\t//console.log(item, esData);\n\t\tres = await (esClient[action])(esData);\n\t} catch(e) {\n\t\tconsole.log(e);\n\t}\n\t//console.log(res);\n}\n\nGitlab.prototype.webhook = async function(ctx) {\n\tconst self = this;\n\tconst params = ctx.request.body;\n\tconst commit = params.commits[0];\n\tconst project_url = params.project.http_url;\n\tconst origin = wurl(\"protocol\", project_url) + \"://\" + wurl(\"hostname\", project_url);\n\tconst gitcfg = {\n\t\trawBaseUrl:origin,\n\t\tproject_id:params.project_id,\n\t\texternal_username: params.user_username,\n\t\tusername:\"xiaoyao\",\t\n\t\ttoken:config.gitlabToken,\n\t}\n\tconst git = gitlabFactory(gitcfg);\n\t\n\t// 取出文件列表\n\tconst filelist = [];\n\tconst dataFileReg = /^[\\w\\d]+_data\\/([_\\w]+)\\/.+\\.yaml$/;\n\tconst filelistAddItem = (path, oper, action) => {\n\t\tif (!dataFileReg.test(path)) return;\n\t\t\n\t\tconst tablename = path.match(dataFileReg)[1];\n\t\t\n\t\tfilelist.push({\n\t\t\tpath:path, \n\t\t\ttablename:tablename,\n\t\t\toper:oper,\n\t\t\taction:action,\n\t\t});\n\t}\n\n\t_.each(params.commits, commit => {\n\t\t_.each(commit.added, (path) => filelistAddItem(path, \"added\", \"index\"));\n\t\t_.each(commit.modified, (path) => filelistAddItem(path, \"modified\", \"index\"));\n\t\t_.each(commit.removed, (path) => filelistAddItem(path, \"removed\", \"delete\"));\n\t});\n\n\tconst promises = [];\n\t_.each(filelist, (item) => {\n\t\tpromises.push(git.getContent(item.path).then(content => {\n\t\t\titem.content = content;\n\t\t\titem.data = self.getGitFileData(content) || {};\n\t\t\t//console.log(item);\n\t\t\t//item.esData = self.formatESData(item.data),\n\t\t}));\n\t});\n\n\tawait Promise.all(promises);\n\n\t//console.log(filelist);\n\t_.each(filelist, file => self.submitESData(file));\n\n\treturn ;\n}\n\n// 提供接口 写git es\nGitlab.prototype.gitlab = async (ctx) => {\n\tconst params = ctx.request.body;\n\n\tif (!params.git || !params.git.projectId || !params.path || !params.data) return ERR.ERR_PARAMS;\n\n\tconst gitcfg = params.git;\n\tgitcfg.token = gitcfg.token || config.gitlabToken;\n\tconst git = gitlabFactory(gitcfg);\n\n\tgit.upsertFile();\n}\n\nGitlab.prototype.getRoutes = function() {\n\tconst prefix = \"/gitlab\";\n\tconst routes = [\n\t{\n\t\tpath: prefix + \"/webhook\",\n\t\tmethod: \"post\",\n\t\taction: \"webhook\",\n\t},\n\t];\n\n\treturn routes;\n}\n\nexport default new Gitlab();\n\n\n\n// WEBPACK FOOTER //\n// ./server/controllers/gitlab.js","import _ from \"lodash\";\nimport {validate} from \"../middlewares/index.js\";\n\nimport {ERR_UNATUH} from \"../common/error.js\";\n\nimport user from \"./user.js\";\nimport dataSource from \"./dataSource.js\";\nimport gitlab from \"./gitlab.js\"; \n\nexport const controllers = {\n\tuser,\n\tdataSource,\n\tgitlab,\n}\n\nexport const registerControllerRouter = function(router) {\n\t_.each(controllers, ctrl => {\n\t\t_.each(ctrl.getRoutes(), (route) => {\n\t\t\tconst methods = _.isArray(route.method) ? route.method : [route.method || \"get\"];\n\t\t\t_.each(methods, method => {\n\t\t\t\tmethod = _.lowerCase(method);\n\t\t\t\t//console.log(method, route.path);\n\t\t\t\trouter[method](route.path, validate(route.validate), async (ctx, next) => {\n\t\t\t\t\t// 认证中间件\n\t\t\t\t\tif (route.requireAuth && !ctx.state.user) {\n\t\t\t\t\t\tctx.body = ERR_UNATUH;\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tctx.state.user = ctx.state.user || {};\n\n\t\t\t\t\ttry {\n\t\t\t\t\t\tconst body = await ctrl[route.action](ctx);\t\n\t\t\t\t\t\tctx.body = body || ctx.body;\n\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\tconsole.log(e);\n\t\t\t\t\t\tctx.status = 500;\n\t\t\t\t\t\tctx.body = \"请求无法处理\";\n\t\t\t\t\t}\n\t\t\t\t\t//console.log(ctx.body);\n\t\t\t\t});\n\t\t\t})\n\t\t\t\n\t\t})\n\t});\n\n\trouter.all(\"/*\", (ctx, next) => {\n\t\tctx.status = 404;\n\t});\n}\n\nexport default registerControllerRouter;\n\n\n\n// WEBPACK FOOTER //\n// ./server/controllers/index.js","import _ from \"lodash\";\nimport joi from \"joi\";\nimport jwt from \"jwt-simple\";\n\nimport config from \"../config.js\";\nimport {ERR, ERR_OK} from \"../common/error.js\";\nimport userModel from \"../models/user.js\";\n\nexport const User = function() {\n\tthis.model = userModel;\n}\n\nUser.prototype.create = function() {\n\n} \n\nUser.prototype.update = function() {\n\n}\n\nUser.prototype.delete = function() {\n\n}\n\nUser.prototype.find = function() {\n\n}\n\nUser.prototype.register = async function(ctx) {\n\tconst params = ctx.request.body;\n\tlet user = await this.model.findOne({\n\t\twhere: {\n\t\t\tusername: params.username,\n\t\t},\n\t});\n\t\n\tif (user) \treturn ERR.setMessage(\"用户已存在\");\n\n\tuser = await this.model.create({\n\t\tusername: params.username,\n\t\tpassword: params.password,\n\t});\n\n\tif (!user) return ERR;\n\n\treturn ERR_OK.setData({\n\t\ttoken: jwt.encode({\n\t\t\tuserId: user._id, \n\t\t\tusername: user.username\n\t\t}, config.secret),\n\t\tuserinfo: user,\n\t});\n}\n\nUser.prototype.login = async function(ctx) {\n\tconst params = ctx.request.body;\n\tlet user = await this.model.findOne({\n\t\twhere: {\n\t\t\tusername: params.username,\n\t\t\tpassword: params.password,\n\t\t},\n\t});\n\t\n\tif (!user) {\n\t\treturn ERR.setMessage(\"用户名或密码错误\");\n\t}\n\n\tuser = user.get({plain:true});\n\n\n\treturn ERR_OK.setData({\n\t\ttoken: jwt.encode({\n\t\t\tuserId: user._id, \n\t\t\tusername: user.username\n\t\t}, config.secret),\n\t\tuserinfo: user,\n\t});\n}\n\nUser.prototype.isLogin = async function(ctx) {\n\tthis.model.findById(1);\n\treturn \"hello world\";\n}\n\nUser.prototype.getRoutes = function() {\n\tconst self = this;\n\tconst prefix = \"/user\";\n\tconst routes = [\n\t{\n\t\tpath: prefix + \"/register\",\n\t\tmethod: \"post\",\n\t\taction: \"register\",\n\t\tvalidate: {\n\t\t\tbody: {\n\t\t\t\tusername: joi.string().min(4).max(48).required(),\n\t\t\t\tpassword: joi.string().min(4).max(48).required(),\n\t\t\t},\n\t\t}\n\t},\n\n\t{\n\t\tpath: prefix + \"/login\",\n\t\tmethod: \"post\",\n\t\taction: \"login\",\n\t\tvalidate: {\n\t\t\tbody: {\n\t\t\t\tusername: joi.string().min(4).max(48).required(),\n\t\t\t\tpassword: joi.string().min(4).max(48).required(),\n\t\t\t},\n\t\t}\n\t},\n\n\t{\n\t\tpath: prefix + \"/isLogin\",\n\t\tmethod: \"get\",\n\t\taction: \"isLogin\",\n\t},\n\t];\n\n\treturn routes;\n}\n\nexport default new User();\n\n\n\n// WEBPACK FOOTER //\n// ./server/controllers/user.js","import _validate from \"./validate.js\";\n\n\nexport const validate = _validate;\n\nexport default {\n\tvalidate,\n}\n\n\n\n// WEBPACK FOOTER //\n// ./server/middlewares/index.js","import _ from 'lodash';\nimport joi from 'joi';\n\nimport {ERR_PARAMS} from \"../common/error.js\";\n\nexport const validate = (schema = {}) => {\n\tconst { opt = {} } = schema;\n\tconst options = _.defaultsDeep(opt, {\n    \tallowUnknown: true,\n  \t});\n  \treturn async (ctx, next) => {\n    \tconst defaultValidateKeys = ['body', 'query', 'params'];\n    \tconst needValidateKeys = _.intersection(defaultValidateKeys, Object.keys(schema));\n\n    \tconst errors = [];\n    \tneedValidateKeys.find((item) => {\n      \t\tconst toValidateObj = item === 'body' ? ctx.request.body : ctx[item];\n      \t\tconst result = joi.validate(toValidateObj, schema[item], options);\n      \t\tif (result.error) {\n        \t\terrors.push(result.error.details[0]);\n        \t\treturn true;\n      \t\t}\n      \t\t_.assignIn(toValidateObj, result.value);\n      \t\treturn false;\n    \t});\n\n    \tif (errors.length !== 0) {\n      \t\tconst msg = errors[0].message.replace(/\"/g, '');\n\t\t\tctx.body = ERR_PARAMS.setMessage(msg);\n\t\t\treturn;\n    \t}\n\n    \tawait next();\n  \t};\n};\n\nexport default validate;\n\n\n\n// WEBPACK FOOTER //\n// ./server/middlewares/validate.js","\nimport _User from \"./user.js\";\nimport _DataSource from \"./dataSource.js\";\n\nexport const User = _User;\nexport const DataSource = _DataSource;\n\nexport default {\n\tUser,\n\tDataSource,\n}\n\n\n\n// WEBPACK FOOTER //\n// ./server/models/index.js","\nexport default {\n\tport:8088,\n\n\tapiUrlPrefix: \"/api/v0\",\n\tgitlabToken: \"18ayouuEsKRo_yM1P5eF\",\n\n\tsecret: \"keepwork\",\n\n\tdatabase: {\n\t\t//port:3306,\n\t\thost: '39.106.11.114',\n\t\ttype: \"mysql\",\n\t\tdatabase: \"keepwork\", // 数据库名\n\t\tusername: \"wuxiangan\",\n\t\tpassword: \"wuxiangan\", \n\t},\n}\n\n\n\n\n// WEBPACK FOOTER //\n// ./server/prod.config.js","module.exports = require(\"@koa/cors\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"@koa/cors\"\n// module id = 26\n// module chunks = 0","module.exports = require(\"elasticsearch\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"elasticsearch\"\n// module id = 27\n// module chunks = 0","module.exports = require(\"js-base64\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"js-base64\"\n// module id = 28\n// module chunks = 0","module.exports = require(\"js-yaml\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"js-yaml\"\n// module id = 29\n// module chunks = 0","module.exports = require(\"koa-body\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-body\"\n// module id = 30\n// module chunks = 0","module.exports = require(\"koa-jwt\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-jwt\"\n// module id = 31\n// module chunks = 0","module.exports = require(\"koa-router\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-router\"\n// module id = 32\n// module chunks = 0","module.exports = require(\"koa-session\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-session\"\n// module id = 33\n// module chunks = 0","module.exports = require(\"node-gitlab-api\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"node-gitlab-api\"\n// module id = 34\n// module chunks = 0","module.exports = require(\"regenerator-runtime\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"regenerator-runtime\"\n// module id = 35\n// module chunks = 0","import Koa from 'koa'\nimport { Nuxt, Builder } from 'nuxt'\n\nimport server from \"./server.js\";\nimport _config from \"./config.js\";\n\nasync function start () {\n  const app = new Koa()\n\n  // Import and Set Nuxt.js options\n  let config = require('../nuxt.config.js')\n  config.dev = !(app.env === 'production')\n\n  // Instantiate nuxt.js\n  const nuxt = new Nuxt(config)\n\n  // Build in development\n  if (config.dev) {\n    const builder = new Builder(nuxt)\n    await builder.build()\n  }\n\n  server(app);\n\n  app.use(async (ctx, next) => {\n    await next()\n    ctx.status = 200 // koa defaults to 404 when it sees that status is unset\n    return new Promise((resolve, reject) => {\n      ctx.res.on('close', resolve)\n      ctx.res.on('finish', resolve)\n\t  ctx.req.ctx = ctx;\n      nuxt.render(ctx.req, ctx.res, promise => {\n        // nuxt.render passes a rejected promise into callback on error.\n        promise.then(resolve).catch(reject)\n      })\n    })\n  })\n\n  const host = _config.host || '127.0.0.1'\n  const port = _config.port || 3000\n  app.listen(port, host)\n  console.log('Server listening on ' + host + ':' + port) // eslint-disable-line no-console\n}\n\nstart()\n\n\n\n// WEBPACK FOOTER //\n// ./server/index.js"],"sourceRoot":""}