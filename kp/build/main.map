{"version":3,"sources":["webpack:///webpack/bootstrap 013e25d8f700fd372824","webpack:///external \"lodash\"","webpack:///./~/babel-runtime/regenerator/index.js","webpack:///./server/common/error.js","webpack:///./server/config.js","webpack:///external \"joi\"","webpack:///external \"sequelize\"","webpack:///external \"koa\"","webpack:///./common/api/gitlab.js","webpack:///./server/models/dataSource.js","webpack:///./server/models/database.js","webpack:///./server/models/user.js","webpack:///external \"jwt-simple\"","webpack:///external \"wurl\"","webpack:///./nuxt.config.js","webpack:///./server/server.js","webpack:///external \"nuxt\"","webpack:///./common/api/elasticSearch.js","webpack:///./server/controllers/dataSource.js","webpack:///./server/controllers/gitlab.js","webpack:///./server/controllers/index.js","webpack:///./server/controllers/user.js","webpack:///./server/middlewares/index.js","webpack:///./server/middlewares/validate.js","webpack:///./server/models/index.js","webpack:///./server/prod.config.js","webpack:///external \"@koa/cors\"","webpack:///external \"elasticsearch\"","webpack:///external \"js-base64\"","webpack:///external \"js-yaml\"","webpack:///external \"koa-body\"","webpack:///external \"koa-jwt\"","webpack:///external \"koa-router\"","webpack:///external \"koa-session\"","webpack:///external \"node-gitlab-api\"","webpack:///external \"regenerator-runtime\"","webpack:///./server/index.js","webpack:///./common/config.js"],"names":["Err","code","message","data","prototype","setMessage","setCode","setData","ERR","ERR_OK","ERR_PARAMS","ERR_UNATUH","ERR_NOT_FOUND","defaultConfig","gitlabToken","secret","database","host","type","username","password","productionConfig","developmentConfig","configs","defaultUsername","apiBaseUrl","rawBaseUrl","token","ref","branch","projectId","xiaoyaoConfig","externalUsername","projectName","keepworkConfig","gitlab","gits","encodeUrl","url","encodeURIComponent","replace","getUsernameByPath","path","paths","split","i","length","Gitlab","config","_","mapKeys","value","key","camelCase","cfg","api","getFile","RepositoryFiles","show","then","file","content","Base64","decode","getContent","upsertFile","options","editFile","createFile","edit","create","removeFile","remove","getTree","Repositories","tree","getFileGitUrl","initConfig","getGitByPath","git","gitlabFactory","DataSource","sequelize","define","id","Sequelize","BIGINT","autoIncrement","primaryKey","name","STRING","unique","externalUserId","externalPassword","isDefault","BOOLEAN","dbconfig","dialect","operatorsAliases","pool","max","min","acquire","idle","User","set","val","setDataValue","toUpperCase","email","cellphone","nickname","portrait","sex","module","exports","srcDir","env","HOST","PORT","router","plugins","src","ssr","head","title","meta","charset","hid","link","rel","href","css","loading","color","build","extend","ctx","resolve","alias","node","fs","tls","net","apiRouter","prefix","apiUrlPrefix","registerControllerRouter","app","views","viewRouter","use","cors","KoaBody","jwt","passthrough","cookie","seesion","signed","routes","allowedMethods","client","elasticsearch","Client","elasticsearchFactory","defaultDataSource","model","update","delete","find","getSystemDataSource","cloneDeep","getDefaultDataSource","params","request","query","authUsername","state","user","dataSource","findOne","where","get","plain","undefined","getRoutes","getGitData","JSON","parse","console","log","formatSiteinfoESData","formatUserinfoESData","formatPageinfoESData","formatESDataMap","getGitFileData","yaml","safeLoad","json","e","formatESData","tablename","format","submitESData","item","action","indexs","index_prefix","version","esData","index","join","body","res","esClient","webhook","self","commit","commits","project_url","project","http_url","origin","wurl","gitcfg","project_id","external_username","user_username","filelist","dataFileReg","filelistAddItem","oper","test","match","push","each","added","modified","removed","promises","Promise","all","method","controllers","ctrl","route","methods","isArray","lowerCase","validate","next","requireAuth","status","register","encode","userId","_id","userinfo","login","isLogin","findById","joi","string","required","schema","opt","defaultsDeep","allowUnknown","defaultValidateKeys","needValidateKeys","intersection","Object","keys","errors","toValidateObj","result","error","details","assignIn","msg","port","require","dev","nuxt","builder","server","reject","on","req","render","promise","catch","_config","listen","start","urlPrefix","pageSuffix","tagModsPath"],"mappings":"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","file":"main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 35);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 013e25d8f700fd372824","module.exports = require(\"lodash\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash\"\n// module id = 0\n// module chunks = 0","module.exports = require(\"regenerator-runtime\");\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/babel-runtime/regenerator/index.js\n// module id = 1\n// module chunks = 0","\nexport const Err = function(code, message, data) {\n\tthis.code = code || 0;\n\tthis.message = message || \"OK\";\n\tthis.data = data || null; // 请求数据\n}\n\nErr.prototype.setMessage = function(message = \"OK\"){\n\tthis.message = message;\n\treturn this;\n}\n\nErr.prototype.setCode = function(code = 0){\n\tthis.code = code; \n\treturn this;\n}\n\nErr.prototype.setData = function(data){\n\tthis.data = data;\n\treturn this;\n}\n\nexport const ERR = new Err(-1, \"unknown error\");\nexport const ERR_OK = new Err();\nexport const ERR_PARAMS = new Err(1, \"参数错误\");\nexport const ERR_UNATUH = new Err(2, \"未认证\");\nexport const ERR_NOT_FOUND = new Err(3, \"未找到记录\");\n\nexport default {\n\tERR,\n\tERR_OK,\n\tERR_PARAMS,\n\tERR_UNATUH,\n\tERR_NOT_FOUND,\n};\n\n\n\n\n\n\n\n// WEBPACK FOOTER //\n// ./server/common/error.js","import commonConfig from \"../common/config.js\";\nimport config from \"./prod.config.js\";\n\nconst defaultConfig = {\n\t...commonConfig,\n\n\tgitlabToken: \"18ayouuEsKRo_yM1P5eF\",\n\n\tsecret: \"keepwork\",\n\n\tdatabase: {\n\t\t//port:3306,\n\t\thost: '39.106.11.114',\n\t\ttype: \"mysql\",\n\t\tdatabase: \"keepwork\", // 数据库名\n\t\tusername: \"wuxiangan\",\n\t\tpassword: \"xxxxxx\", \n\t},\n}\n\nconst productionConfig = {\n\t...defaultConfig,\n\t\n\t...config,\n}\n\nconst developmentConfig = {\n\t...defaultConfig,\n\n\t...config,\n}\n\nconst configs = {\n\t\"production\": productionConfig,\n\t\"development\": developmentConfig,\n}\n\nexport default configs[process.env.NODE_ENV];\n\n\n\n// WEBPACK FOOTER //\n// ./server/config.js","module.exports = require(\"joi\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"joi\"\n// module id = 4\n// module chunks = 0","module.exports = require(\"sequelize\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"sequelize\"\n// module id = 5\n// module chunks = 0","module.exports = require(\"koa\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa\"\n// module id = 6\n// module chunks = 0","import gitlabApi from \"node-gitlab-api\";\nimport {Base64} from \"js-base64\";\nimport _ from \"lodash\";\n\nconst defaultUsername = \"keepwork\";\n\nconst defaultConfig = {\n\tapiBaseUrl:\"https://gitlab.com\",\n\trawBaseUrl:\"https://gitlab.com\",\n\ttoken:\"Ed9S7hSfiruewMR-jitR\",\n\tref:\"master\",\n\tbranch:\"master\",\n\tprojectId:4980659,\n\t//rootPath:\"xiaoyao\",\n};\n\nconst xiaoyaoConfig = {\n\tusername:\"xiaoyao\",\n\tprojectId: 4980659,\n\texternalUsername: \"wxaxiaoyao\",\n\tprojectName: \"keepworkdatasource\",\n\ttoken:\"Ed9S7hSfiruewMR-jitR\",\n\tref: \"master\",\n\tbranch: \"master\",\n}\n\nconst keepworkConfig = {\n\tusername:\"keepwork\",\n\texternalUsername: \"keepwork\",\n\tprojectName: \"keepworkdatasource\",\n\thost:\"https://gitlab.com\",\n\ttoken:\"9x94xLa-CZPH9Da5h5kd\",\n\tref:\"master\",\n\tbranch: \"master\",\n\tprojectId:5112836,\n}\n\nconst gitlab = {\n\tgits:{\n\n\t}\n}\n\nconst encodeUrl = function(url) {\n\treturn encodeURIComponent(url).replace(/\\./g,'%2E')\n}\n\nconst getUsernameByPath = function(path) {\n\tconst paths = (path || \"\").split(\"/\");\n\tlet username = \"keepwork\";\n\tfor (let i = 0; i < paths.length; i++) {\n\t\tif (paths[i]) {\n\t\t\tusername = paths[i];\n\t\t\tbreak;\n\t\t}\n\t}\n\n\tusername = username.replace(/_(data|files)$/, \"\");\n\n\treturn username;\n}\n\nfunction Gitlab(config){\n\tconfig = _.mapKeys(config || {}, (value, key) => _.camelCase(key));\n\tthis.cfg = {\n\t\t...defaultConfig,\n\t\t...((gitlab.gits[config.username] || {}).cfg || {}),\n\t\t...(config || {}),\n\t};\n\t//console.log(cfg);\n\t\n\tthis.api = new gitlabApi({url:this.cfg.rawBaseUrl, token:this.cfg.token});\n\t//return this;\n}\n\nGitlab.prototype.getFile = function(path) {\n\treturn this.api.RepositoryFiles.show(this.cfg.projectId, path, this.cfg.ref).then(file => {\n\t\tfile.content = Base64.decode(file.content);\n\t\treturn file;\n\t});\n}\n\nGitlab.prototype.getContent = function(path) {\n\treturn this.api.RepositoryFiles.show(this.cfg.projectId, path, this.cfg.ref).then(file => Base64.decode(file.content));\n}\n\nGitlab.prototype.upsertFile = function(path, options) {\n\tconst file = this.getFile(path);\n\treturn file ? this.editFile(path, options) : this.createFile(path, options);\n}\n\nGitlab.prototype.editFile = function(path, options) {\n\treturn this.api.RepositoryFiles.edit(this.cfg.projectId, path, this.cfg.branch, options);\n}\n\nGitlab.prototype.createFile = function(path, options) {\n\treturn this.api.RepositoryFiles.create(this.cfg.projectId, path, this.cfg.branch, options);\n}\n\nGitlab.prototype.removeFile = function(path, options) {\n\treturn this.api.RepositoryFiles.remove(this.cfg.projectId, path, this.cfg.branch, options);\n}\n\nGitlab.prototype.getTree = function(path, options) {\n\toptions = options || {};\n\toptions.path = path;\n\n\treturn this.api.Repositories.tree(this.cfg.projectId, options);\n}\n\nGitlab.prototype.getFileGitUrl = function(path) {\n\tconst url = this.cfg.rawBaseUrl + \"/\" + this.cfg.externalUsername + \"/\" + this.cfg.projectName + '/blob/' + \"master\" + '/' + path;\n\t\n\treturn url;\n}\n\ngitlab.initConfig = function(config){\n\tif (!config || !config.username) {\n\t\treturn;\n\t}\n\t\n\tthis.gits[config.username] = new Gitlab(config);\n}\n\ngitlab.getGitByPath = function(path) {\n\tconst username = getUsernameByPath(path);\n\treturn this.gits[username] || this.gits[defaultUsername];\n}\n\ngitlab.getContent = function(path) {\n\treturn this.getGitByPath(path).getContent(path);\n}\n\ngitlab.getFile = function(path) {\n\treturn this.getGitByPath(path).getFile(path);\n}\n\ngitlab.editFile = function(path, options) {\n\tconst git = this.getGitByPath(path);\n\treturn git.editFile(path, options);\n}\n\ngitlab.createFile = function(path, options) {\n\tconst git = this.getGitByPath(path);\n\t//path = encodeUrl(path);\n\treturn git.createFile(path, options);\n}\n\ngitlab.removeFile = function(path, options) {\n\tconst git = this.getGitByPath(path);\n\treturn git.removeFile(path, options);\n}\n\ngitlab.getTree = function(path, options) {\n\tconst git = this.getGitByPath(path);\n\treturn git.getTree(path, options);\n}\n\ngitlab.getFileGitUrl = function(path) {\n\treturn this.getGitByPath(path).getFileGitUrl(path);\n}\n\ngitlab.initConfig(keepworkConfig);\ngitlab.initConfig(xiaoyaoConfig);\n\nexport const gitlabFactory = (config) => new Gitlab(config);\nexport default gitlab;\n\n\n\n// WEBPACK FOOTER //\n// ./common/api/gitlab.js","import Sequelize from 'sequelize';\nimport sequelize from \"./database.js\";\n\nconst DataSource = sequelize.define(\"dataSource\", {\n\tid: {\n\t\ttype: Sequelize.BIGINT,\n\t\tautoIncrement: true,\n\t\tprimaryKey: true,\n\t},\n\n\tname: {\n\t\ttype: Sequelize.STRING(48),\n\t\tunique: true,\n\t},\n\n\ttype: {\n\t\ttype: Sequelize.STRING(12),\n\t},\n\n\ttoken: {\n\t\ttype: Sequelize.STRING(128),\n\t\t//allowNull, false,\n\t},\n\n\tapiBaseUrl: {\n\t\ttype: Sequelize.STRING(64),\n\t},\n\n\trawBaseUrl: {\n\t\ttype: Sequelize.STRING(64),\n\t},\n\n\texternalUserId: {\n\t\ttype: Sequelize.BIGINT,\n\t},\n\n\texternalUsername: {\n\t\ttype: Sequelize.STRING(48),\n\t},\n\n\texternalPassword: {\n\t\ttype: Sequelize.STRING(128),\n\t},\n\t\n\tisDefault: {\n\t\ttype: Sequelize.BOOLEAN,\n\t},\n});\n\n//DataSource.sync({force:true}).then(() => {\n\t//console.log(\"create dataSource table successfully\");\n//});\n\nexport default DataSource;\n\n\n\n// WEBPACK FOOTER //\n// ./server/models/dataSource.js","import Sequelize from 'sequelize';\nimport config from \"../config.js\";\n\nconst dbconfig = config.database;\n\nconst sequelize = new Sequelize(dbconfig.database, dbconfig.username, dbconfig.password, {\n  host: dbconfig.host,\n  dialect: dbconfig.type,\n  operatorsAliases: false,\n\n  pool: {\n    max: 5,\n    min: 0,\n    acquire: 30000,\n    idle: 10000\n  },\n\n  // SQLite only\n  //storage: 'path/to/database.sqlite'\n});\n\n//sequelize\n  //.authenticate()\n  //.then(() => {\n    //console.log('Connection has been established successfully.');\n  //})\n  //.catch(err => {\n    //console.error('Unable to connect to the database:', err);\n  //});\n\nexport default sequelize;\n\n\n\n// WEBPACK FOOTER //\n// ./server/models/database.js","import Sequelize from 'sequelize';\nimport sequelize from \"./database.js\";\n\nconst User = sequelize.define('user', {\n\tid: {\n\t\ttype: Sequelize.BIGINT,\n\t\tautoIncrement: true,\n\t\tprimaryKey: true,\n\t},\n\t\n\tusername: {\n\t\ttype: Sequelize.STRING(48),\n\t\tunique: true,\n\t},\n\n\tpassword: {\n\t\ttype: Sequelize.STRING(48),\n\n\t\tset(val) {\n\t\t\tthis.setDataValue(\"password\", val.toUpperCase());\n\t\t},\n\t},\n\n\temail: {\n\t\ttype: Sequelize.STRING(24),\n\t\tunique: true,\n\t},\n\n\tcellphone: {\n\t\ttype: Sequelize.STRING(24),\n\t\tunique: true,\n\t},\n\n\tnickname: {\n\t\ttype: Sequelize.STRING,\n\t},\n\n\tportrait: {\n\t\ttype: Sequelize.STRING,\n\t},\n\n\tsex: {\n\t\ttype: Sequelize.STRING(4),\n\t},\n});\n\n//User.sync({force:true}).then(() => {\n\t//console.log(\"create user table successfully\");\n//});\n\n\nexport default User;\n\n\n\n// WEBPACK FOOTER //\n// ./server/models/user.js","module.exports = require(\"jwt-simple\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"jwt-simple\"\n// module id = 11\n// module chunks = 0","module.exports = require(\"wurl\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"wurl\"\n// module id = 12\n// module chunks = 0","module.exports = {\n\tsrcDir: \"client/\",\n\tenv:{\n\t\t//NODE_ENV:\"development\",\n\t\tHOST: \"0.0.0.0\",\n\t\tPORT: 8088,\n\t},\n\n\trouter: {\n\t},\n\n\tplugins: [\n\t{src:\"~/plugins/element-ui\", ssr: false},\n\t{src:\"~/plugins/codemirror\", ssr: false},\n\t{src:\"~/plugins/persistedstate\", ssr: false},\n\t{src:\"~/plugins/app\", ssr: false},\n\t{src:\"~/plugins/test\", ssr: false},\n\t],\n\t/*\n\t** Headers of the page\n\t*/\n\thead: {\n\t\ttitle: 'starter',\n\t\tmeta: [\n\t\t{ charset: 'utf-8' },\n\t\t{ name: 'viewport', content: 'width=device-width, initial-scale=1' },\n\t\t{ hid: 'description', name: 'description', content: 'Nuxt.js project' }\n\t\t],\n\t\tlink: [\n\t\t{ rel: 'icon', type: 'image/x-icon', href: '/favicon.ico' }\n\t\t]\n\t},\n\n\t//babel: {\n\t\t//plugins: [\n\t\t\t//[\n\t\t\t\t//'component',\n\t\t\t\t//[\n\t\t\t\t//{\n\t\t\t\t//'libraryName': 'element-ui',\n\t\t\t\t//'styleLibraryName': 'theme-default'\n\t\t\t\t//},\n\t\t\t\t//'transform-async-to-generator',\n\t\t\t\t//'transform-runtime'\n\t\t\t\t//]\n\t\t\t//]\n\t\t//],\n\t\t//comments: false\n\t//},\n\t/*\n  \t** Global CSS\n  \t*/\n  \tcss: ['~assets/css/main.css'],\n  \t/*\n  \t** Customize the progress-bar color\n  \t*/\n  \tloading: { color: '#3B8070' },\n  \t/*\n  \t ** Build configuration\n  \t */\n  \tbuild: {\n\t\t/*\n  \t  \t ** Run ESLINT on save\n  \t  \t */\n  \t  \textend (config, ctx) {\n  \t  \t  //if (ctx.isClient) {\n  \t  \t\t//config.module.rules.push({\n  \t  \t\t  //enforce: 'pre',\n  \t  \t\t  //test: /\\.(js|vue)$/,\n  \t  \t\t  //loader: 'eslint-loader',\n  \t  \t\t  //exclude: /(node_modules)/\n  \t  \t\t//})\n  \t  \t  //}\n\t\t\tconfig.resolve.alias = {\n\t\t\t\t...(config.resolve.alias || {}),\n\t\t\t\t\"@\":\"/mnt/d/workspace/lua/keepwork/kp/client/\",\n\t\t\t\t\"common\":\"/mnt/d/workspace/lua/keepwork/kp/common/\",\n\t\t\t\t'vue$':'vue/dist/vue.esm.js',\n\t\t\t},\n\t\t\tconfig.node = {\n\t\t\t\t...(config.node || {}),\n\t\t\t\tfs: \"empty\",\n\t\t\t\ttls: \"empty\",\n  \t  \t\t\tnet: \"empty\",\n  \t  \t\t};\n  \t  \t}\n  \t}\n}\n\n\n\n// WEBPACK FOOTER //\n// ./nuxt.config.js","import Koa from \"koa\";\nimport cors from \"@koa/cors\";\nimport jwt from \"koa-jwt\";\nimport seesion from \"koa-session\";\nimport Router from \"koa-router\";\nimport KoaBody from \"koa-body\";\nimport wurl from \"wurl\";\nimport _ from \"lodash\";\n\nimport registerControllerRouter from \"./controllers/index.js\";\n\n//import log from \"./log.js\";\nimport config from \"./config.js\";\nimport models from \"./models/index.js\";\n\nconst apiRouter = new Router({\n\tprefix: config.apiUrlPrefix,\n});\nregisterControllerRouter(apiRouter);\n\n\nexport default (app, views) => {\n\tconst viewRouter = new Router({});\n\t//viewRouter.get(\"/www/*\", views);\n\n\tapp\n\t.use(cors())\n\t.use(KoaBody())\n\t.use(jwt({secret:config.secret, passthrough:true, cookie:\"token\"}))\n\t.use(seesion({signed: false},app))\n\t.use(apiRouter.routes())\n\t.use(apiRouter.allowedMethods())\n\t.use(viewRouter.routes());\n}\n\n\n\n\n// WEBPACK FOOTER //\n// ./server/server.js","module.exports = require(\"nuxt\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"nuxt\"\n// module id = 15\n// module chunks = 0","\nimport elasticsearch from \"elasticsearch\";\n\nconst defaultConfig = {\n\thost: \"http://10.28.18.7:9200\",\n}\n\nconst client = new elasticsearch.Client({\n\t...defaultConfig,\n});\n\nexport const elasticsearchFactory = (config) => {\n\treturn new elasticsearch.Client({\n\t\t...defaultConfig,\n\t\t...(config || {}),\n\t});\n}\n\nexport default client;\n\n\n\n// WEBPACK FOOTER //\n// ./common/api/elasticSearch.js","import _ from \"lodash\";\nimport joi from \"joi\";\nimport jwt from \"jwt-simple\";\n\nimport config from \"../config.js\";\nimport ERR from \"../common/error.js\";\nimport DataSourceModel from \"../models/dataSource.js\";\n\nconst defaultDataSource = {\n\tusername:\"keepwork\",\n\texternalUsername: \"keepwork\",\n\tprojectName: \"keepworkdatasource\",\n\thost:\"https://gitlab.com\",\n\ttoken:\"9x94xLa-CZPH9Da5h5kd\",\n\tref:\"master\",\n\tbranch: \"master\",\n\tprojectId:5112836,\n}\n\nexport const DataSource = function() {\n\tthis.model = DataSourceModel;\n}\n\nDataSource.prototype.create = function() {\n\n} \n\nDataSource.prototype.update = function() {\n\n}\n\nDataSource.prototype.delete = function() {\n\n}\n\nDataSource.prototype.find = function() {\n\n}\n\nDataSource.prototype.getSystemDataSource = function() {\n\treturn _.cloneDeep(defaultDataSource);\n}\n\n// 获取用户默认数据源\nDataSource.prototype.getDefaultDataSource = function(ctx) {\n\tconst params = ctx.request.query;\n\tconst authUsername = ctx.state.user.username;\n\tconst username = params.username || authUsername;\n\n\tif (!username) return ERR.ERR_PARAMS;\n\t\n\tlet dataSource = this.model.findOne({\n\t\twhere: {\n\t\t\tusername: username,\n\t\t\tisDefault: true,\n\t\t},\n\t});\n\n\tif (!dataSource) return ERR.ERR_NOT_FOUND;\n\n\tdataSource = dataSource.get({plain:true});\n\n\tif (username != authUsername) {\n\t\tdataSource.token = undefined;\n\t\tDataSource.externalPassword = undefined;\n\t}\n\n\treturn dataSource;\n}\n\nDataSource.prototype.getRoutes = function(){\n\treturn [];\n}\n\nexport default new DataSource();\n\n\n\n// WEBPACK FOOTER //\n// ./server/controllers/dataSource.js","import _ from \"lodash\";\nimport joi from \"joi\";\nimport wurl from \"wurl\";\nimport yaml from \"js-yaml\";\n\nimport ERR from \"../common/error.js\";\nimport config from \"../config.js\";\nimport esClient from \"../../common/api/elasticSearch.js\";\nimport {gitlabFactory} from \"../../common//api/gitlab.js\";\nimport gitlab from \"../../common/api/gitlab.js\";\n//import {gitlabFactory} from \"../../vue/src//api/gitlab.js\";\n\n// 获取GIT的ES数据\nconst getGitData = async function(git, path) {\n\ttry {\n\t\tconst content = await git.getContent(path);\n\t\tconst data = JSON.parse(content);\n\t\treturn data;\n\t} catch (e){\n\t\tconsole.log(e);\n\t}\n\treturn;\n} \n\nconst formatSiteinfoESData = function(data) {\n\n}\n\nconst formatUserinfoESData = function(data) {\n\n}\n\nconst formatPageinfoESData = function(data) {\n\n}\n\nconst formatESDataMap = {\n\t\"userinfo\": formatUserinfoESData,\n\t\"siteinfo\": formatSiteinfoESData,\n\t\"pageinfo\": formatPageinfoESData,\n}\n\nexport const Gitlab = function() {\n\t\n}\n\n// 获取git文件中的数据信息\nGitlab.prototype.getGitFileData = function(content) {\n\ttry {\n\t\t//return Json.parse(content);\n\t\treturn yaml.safeLoad(content, {json:true});\n\t} catch(e) {\n\t\tconsole.log(e);\n\t}\n\n\treturn ;\n}\n\nGitlab.prototype.formatESData = function(data, tablename) {\n\tdata = _.cloneDeep(data || {});\n\tconst format = formatESDataMap[tablename];\n\n\tformat && format(data);\n\n\treturn data;\n}\n\nGitlab.prototype.submitESData = async function(item) {\n\tconst data = item.data || {};\n\tconst tablename = item.tablename;\n\tconst path = item.path;\n\tconst action = item.action;\n\tconst indexs = [data.index_prefix || \"kw\", tablename, data.version || \"v0\"];\n\tconst esData = {\n\t\tindex: indexs.join(\"_\"),\n\t\ttype: tablename,\n\t\tid: path.replace(/\\//g, \"_\"),\n\t\tbody: data.data || {},\n\t}\n\tesData.body.path = path;\n\n\tlet res = null;\n\ttry {\n\t\t//console.log(item, esData);\n\t\tres = await (esClient[action])(esData);\n\t} catch(e) {\n\t\tconsole.log(e);\n\t}\n\t//console.log(res);\n}\n\nGitlab.prototype.webhook = async function(ctx) {\n\tconst self = this;\n\tconst params = ctx.request.body;\n\tconst commit = params.commits[0];\n\tconst project_url = params.project.http_url;\n\tconst origin = wurl(\"protocol\", project_url) + \"://\" + wurl(\"hostname\", project_url);\n\tconst gitcfg = {\n\t\trawBaseUrl:origin,\n\t\tproject_id:params.project_id,\n\t\texternal_username: params.user_username,\n\t\tusername:\"xiaoyao\",\t\n\t\ttoken:config.gitlabToken,\n\t}\n\tconst git = gitlabFactory(gitcfg);\n\t\n\t// 取出文件列表\n\tconst filelist = [];\n\tconst dataFileReg = /^[\\w\\d]+_data\\/([_\\w]+)\\/.+\\.yaml$/;\n\tconst filelistAddItem = (path, oper, action) => {\n\t\tif (!dataFileReg.test(path)) return;\n\t\t\n\t\tconst tablename = path.match(dataFileReg)[1];\n\t\t\n\t\tfilelist.push({\n\t\t\tpath:path, \n\t\t\ttablename:tablename,\n\t\t\toper:oper,\n\t\t\taction:action,\n\t\t});\n\t}\n\n\t_.each(params.commits, commit => {\n\t\t_.each(commit.added, (path) => filelistAddItem(path, \"added\", \"index\"));\n\t\t_.each(commit.modified, (path) => filelistAddItem(path, \"modified\", \"index\"));\n\t\t_.each(commit.removed, (path) => filelistAddItem(path, \"removed\", \"delete\"));\n\t});\n\n\tconst promises = [];\n\t_.each(filelist, (item) => {\n\t\tpromises.push(git.getContent(item.path).then(content => {\n\t\t\titem.content = content;\n\t\t\titem.data = self.getGitFileData(content) || {};\n\t\t\t//console.log(item);\n\t\t\t//item.esData = self.formatESData(item.data),\n\t\t}));\n\t});\n\n\tawait Promise.all(promises);\n\n\t//console.log(filelist);\n\t_.each(filelist, file => self.submitESData(file));\n\n\treturn ;\n}\n\n// 提供接口 写git es\nGitlab.prototype.gitlab = async (ctx) => {\n\tconst params = ctx.request.body;\n\n\tif (!params.git || !params.git.projectId || !params.path || !params.data) return ERR.ERR_PARAMS;\n\n\tconst gitcfg = params.git;\n\tgitcfg.token = gitcfg.token || config.gitlabToken;\n\tconst git = gitlabFactory(gitcfg);\n\n\tgit.upsertFile();\n}\n\nGitlab.prototype.getRoutes = function() {\n\tconst prefix = \"/gitlab\";\n\tconst routes = [\n\t{\n\t\tpath: prefix + \"/webhook\",\n\t\tmethod: \"post\",\n\t\taction: \"webhook\",\n\t},\n\t];\n\n\treturn routes;\n}\nexport default new Gitlab();\n\n\n\n// WEBPACK FOOTER //\n// ./server/controllers/gitlab.js","import _ from \"lodash\";\nimport {validate} from \"../middlewares/index.js\";\n\nimport {ERR_UNATUH} from \"../common/error.js\";\n\nimport user from \"./user.js\";\nimport dataSource from \"./dataSource.js\";\nimport gitlab from \"./gitlab.js\"; \n\nexport const controllers = {\n\tuser,\n\tdataSource,\n\tgitlab,\n}\n\nexport const registerControllerRouter = function(router) {\n\t_.each(controllers, ctrl => {\n\t\t_.each(ctrl.getRoutes(), (route) => {\n\t\t\tconst methods = _.isArray(route.method) ? route.method : [route.method || \"get\"];\n\t\t\t_.each(methods, method => {\n\t\t\t\tmethod = _.lowerCase(method);\n\t\t\t\t//console.log(method, route.path);\n\t\t\t\trouter[method](route.path, validate(route.validate), async (ctx, next) => {\n\t\t\t\t\t// 认证中间件\n\t\t\t\t\tif (route.requireAuth && !ctx.state.user) {\n\t\t\t\t\t\tctx.body = ERR_UNATUH;\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tctx.state.user = ctx.state.user || {};\n\n\t\t\t\t\ttry {\n\t\t\t\t\t\tconst body = await ctrl[route.action](ctx);\t\n\t\t\t\t\t\tctx.body = body || ctx.body;\n\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\tconsole.log(e);\n\t\t\t\t\t\tctx.status = 500;\n\t\t\t\t\t\tctx.body = \"请求无法处理\";\n\t\t\t\t\t}\n\t\t\t\t\t//console.log(ctx.body);\n\t\t\t\t});\n\t\t\t})\n\t\t\t\n\t\t})\n\t});\n\n\trouter.all(\"/*\", (ctx, next) => {\n\t\tctx.status = 404;\n\t});\n}\n\nexport default registerControllerRouter;\n\n\n\n// WEBPACK FOOTER //\n// ./server/controllers/index.js","import _ from \"lodash\";\nimport joi from \"joi\";\nimport jwt from \"jwt-simple\";\n\nimport config from \"../config.js\";\nimport {ERR, ERR_OK} from \"../common/error.js\";\nimport userModel from \"../models/user.js\";\n\nexport const User = function() {\n\tthis.model = userModel;\n}\n\nUser.prototype.create = function() {\n\n} \n\nUser.prototype.update = function() {\n\n}\n\nUser.prototype.delete = function() {\n\n}\n\nUser.prototype.find = function() {\n\n}\n\nUser.prototype.register = async function(ctx) {\n\tconst params = ctx.request.body;\n\tlet user = await this.model.findOne({\n\t\twhere: {\n\t\t\tusername: params.username,\n\t\t},\n\t});\n\t\n\tif (user) \treturn ERR.setMessage(\"用户已存在\");\n\n\tuser = await this.model.create({\n\t\tusername: params.username,\n\t\tpassword: params.password,\n\t});\n\n\tif (!user) return ERR;\n\n\treturn ERR_OK.setData({\n\t\ttoken: jwt.encode({\n\t\t\tuserId: user._id, \n\t\t\tusername: user.username\n\t\t}, config.secret),\n\t\tuserinfo: user,\n\t});\n}\n\nUser.prototype.login = async function(ctx) {\n\tconst params = ctx.request.body;\n\tlet user = await this.model.findOne({\n\t\twhere: {\n\t\t\tusername: params.username,\n\t\t\tpassword: params.password,\n\t\t},\n\t});\n\t\n\tif (!user) {\n\t\treturn ERR.setMessage(\"用户名或密码错误\");\n\t}\n\n\tuser = user.get({plain:true});\n\n\n\treturn ERR_OK.setData({\n\t\ttoken: jwt.encode({\n\t\t\tuserId: user._id, \n\t\t\tusername: user.username\n\t\t}, config.secret),\n\t\tuserinfo: user,\n\t});\n}\n\nUser.prototype.isLogin = async function(ctx) {\n\tthis.model.findById(1);\n\treturn \"hello world\";\n}\n\nUser.prototype.getRoutes = function() {\n\tconst self = this;\n\tconst prefix = \"/user\";\n\tconst routes = [\n\t{\n\t\tpath: prefix + \"/register\",\n\t\tmethod: \"post\",\n\t\taction: \"register\",\n\t\tvalidate: {\n\t\t\tbody: {\n\t\t\t\tusername: joi.string().min(4).max(48).required(),\n\t\t\t\tpassword: joi.string().min(4).max(48).required(),\n\t\t\t},\n\t\t}\n\t},\n\n\t{\n\t\tpath: prefix + \"/login\",\n\t\tmethod: \"post\",\n\t\taction: \"login\",\n\t\tvalidate: {\n\t\t\tbody: {\n\t\t\t\tusername: joi.string().min(4).max(48).required(),\n\t\t\t\tpassword: joi.string().min(4).max(48).required(),\n\t\t\t},\n\t\t}\n\t},\n\n\t{\n\t\tpath: prefix + \"/isLogin\",\n\t\tmethod: \"get\",\n\t\taction: \"isLogin\",\n\t},\n\t];\n\n\treturn routes;\n}\n\nexport default new User();\n\n\n\n// WEBPACK FOOTER //\n// ./server/controllers/user.js","import _validate from \"./validate.js\";\n\n\nexport const validate = _validate;\n\nexport default {\n\tvalidate,\n}\n\n\n\n// WEBPACK FOOTER //\n// ./server/middlewares/index.js","import _ from 'lodash';\nimport joi from 'joi';\n\nimport {ERR_PARAMS} from \"../common/error.js\";\n\nexport const validate = (schema = {}) => {\n\tconst { opt = {} } = schema;\n\tconst options = _.defaultsDeep(opt, {\n    \tallowUnknown: true,\n  \t});\n  \treturn async (ctx, next) => {\n    \tconst defaultValidateKeys = ['body', 'query', 'params'];\n    \tconst needValidateKeys = _.intersection(defaultValidateKeys, Object.keys(schema));\n\n    \tconst errors = [];\n    \tneedValidateKeys.find((item) => {\n      \t\tconst toValidateObj = item === 'body' ? ctx.request.body : ctx[item];\n      \t\tconst result = joi.validate(toValidateObj, schema[item], options);\n      \t\tif (result.error) {\n        \t\terrors.push(result.error.details[0]);\n        \t\treturn true;\n      \t\t}\n      \t\t_.assignIn(toValidateObj, result.value);\n      \t\treturn false;\n    \t});\n\n    \tif (errors.length !== 0) {\n      \t\tconst msg = errors[0].message.replace(/\"/g, '');\n\t\t\tctx.body = ERR_PARAMS.setMessage(msg);\n\t\t\treturn;\n    \t}\n\n    \tawait next();\n  \t};\n};\n\nexport default validate;\n\n\n\n// WEBPACK FOOTER //\n// ./server/middlewares/validate.js","\nimport _User from \"./user.js\";\nimport _DataSource from \"./dataSource.js\";\n\nexport const User = _User;\nexport const DataSource = _DataSource;\n\nexport default {\n\tUser,\n\tDataSource,\n}\n\n\n\n// WEBPACK FOOTER //\n// ./server/models/index.js","\nexport default {\n\tport:8088,\n\n\tapiUrlPrefix: \"/api/v0\",\n\tgitlabToken: \"18ayouuEsKRo_yM1P5eF\",\n\n\tsecret: \"keepwork\",\n\n\tdatabase: {\n\t\t//port:3306,\n\t\thost: '39.106.11.114',\n\t\ttype: \"mysql\",\n\t\tdatabase: \"keepwork\", // 数据库名\n\t\tusername: \"wuxiangan\",\n\t\tpassword: \"wuxiangan\", \n\t},\n}\n\n\n\n\n// WEBPACK FOOTER //\n// ./server/prod.config.js","module.exports = require(\"@koa/cors\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"@koa/cors\"\n// module id = 25\n// module chunks = 0","module.exports = require(\"elasticsearch\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"elasticsearch\"\n// module id = 26\n// module chunks = 0","module.exports = require(\"js-base64\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"js-base64\"\n// module id = 27\n// module chunks = 0","module.exports = require(\"js-yaml\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"js-yaml\"\n// module id = 28\n// module chunks = 0","module.exports = require(\"koa-body\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-body\"\n// module id = 29\n// module chunks = 0","module.exports = require(\"koa-jwt\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-jwt\"\n// module id = 30\n// module chunks = 0","module.exports = require(\"koa-router\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-router\"\n// module id = 31\n// module chunks = 0","module.exports = require(\"koa-session\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-session\"\n// module id = 32\n// module chunks = 0","module.exports = require(\"node-gitlab-api\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"node-gitlab-api\"\n// module id = 33\n// module chunks = 0","module.exports = require(\"regenerator-runtime\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"regenerator-runtime\"\n// module id = 34\n// module chunks = 0","import Koa from 'koa'\nimport { Nuxt, Builder } from 'nuxt'\n\nimport server from \"./server.js\";\nimport _config from \"./config.js\";\n\nasync function start () {\n  const app = new Koa()\n\n  // Import and Set Nuxt.js options\n  let config = require('../nuxt.config.js')\n  config.dev = !(app.env === 'production')\n\n  // Instantiate nuxt.js\n  const nuxt = new Nuxt(config)\n\n  // Build in development\n  if (config.dev) {\n    const builder = new Builder(nuxt)\n    await builder.build()\n  }\n\n  server(app);\n\n  app.use(async (ctx, next) => {\n    await next()\n    ctx.status = 200 // koa defaults to 404 when it sees that status is unset\n    return new Promise((resolve, reject) => {\n      ctx.res.on('close', resolve)\n      ctx.res.on('finish', resolve)\n\t  ctx.req.ctx = ctx;\n      nuxt.render(ctx.req, ctx.res, promise => {\n        // nuxt.render passes a rejected promise into callback on error.\n        promise.then(resolve).catch(reject)\n      })\n    })\n  })\n\n  const host = _config.host || '127.0.0.1'\n  const port = _config.port || 3000\n  app.listen(port, host)\n  console.log('Server listening on ' + host + ':' + port) // eslint-disable-line no-console\n}\n\nstart()\n\n\n\n// WEBPACK FOOTER //\n// ./server/index.js","\nconst config = {\n\turlPrefix: \"www\",\n\tapiUrlPrefix: \"/api/v0\",\n\tpageSuffix:\".md\",\n\ttagModsPath: \"keepwork_data/tag_mods.json\",\n\n\n\thost: \"0.0.0.0\",\n\tport: 8088,\n}\n\nexport default config;\n\n\n\n// WEBPACK FOOTER //\n// ./common/config.js"],"sourceRoot":""}