{"version":3,"sources":["webpack:///webpack/bootstrap b7290dd06d852c21cea7","webpack:///./~/babel-runtime/regenerator/index.js","webpack:///external \"lodash\"","webpack:///./server/config.js","webpack:///./server/common/error.js","webpack:///external \"joi\"","webpack:///./client/lib/gitlab-api/infrastructure/index.js","webpack:///external \"sequelize\"","webpack:///external \"koa\"","webpack:///./client/lib/gitlab-api/services/index.js","webpack:///./common/api/gitlab.js","webpack:///./server/models/dataSource.js","webpack:///./server/models/database.js","webpack:///./server/models/user.js","webpack:///external \"jwt-simple\"","webpack:///external \"url-join\"","webpack:///external \"wurl\"","webpack:///./nuxt.config.js","webpack:///./server/server.js","webpack:///external \"nuxt\"","webpack:///./client/lib/gitlab-api/index.js","webpack:///./client/lib/gitlab-api/infrastructure/BaseService.js","webpack:///./client/lib/gitlab-api/infrastructure/Bundler.js","webpack:///./client/lib/gitlab-api/infrastructure/RequestHelper.js","webpack:///./client/lib/gitlab-api/services/Repositories.js","webpack:///./client/lib/gitlab-api/services/RepositoryFiles.js","webpack:///./common/api/elasticSearch.js","webpack:///./common/config.js","webpack:///./server/controllers/dataSource.js","webpack:///./server/controllers/gitlab.js","webpack:///./server/controllers/index.js","webpack:///./server/controllers/user.js","webpack:///./server/middlewares/index.js","webpack:///./server/middlewares/validate.js","webpack:///./server/models/index.js","webpack:///./server/prod.config.js","webpack:///external \"@koa/cors\"","webpack:///external \"axios\"","webpack:///external \"elasticsearch\"","webpack:///external \"humps\"","webpack:///external \"js-base64\"","webpack:///external \"js-yaml\"","webpack:///external \"koa-body\"","webpack:///external \"koa-jwt\"","webpack:///external \"koa-router\"","webpack:///external \"koa-static\"","webpack:///external \"lodash.pick\"","webpack:///external \"parse-link-header\"","webpack:///external \"path\"","webpack:///external \"regenerator-runtime\"","webpack:///external \"webpack\"","webpack:///./server/index.js"],"names":["defaultConfig","gitlabToken","secret","database","host","type","username","password","productionConfig","developmentConfig","configs","Err","code","message","data","prototype","setMessage","setCode","setData","ERR","ERR_OK","ERR_PARAMS","ERR_UNATUH","ERR_NOT_FOUND","BaseService","RequestHelper","Bundler","Repositories","RepositoryFiles","defaultUsername","apiBaseUrl","rawBaseUrl","token","ref","branch","projectId","xiaoyaoConfig","externalUsername","projectName","keepworkConfig","gitlab","gits","encodeUrl","url","encodeURIComponent","replace","getUsernameByPath","path","paths","split","i","length","Gitlab","config","_","mapKeys","value","key","camelCase","cfg","gitcfg","api","getFile","show","then","file","content","Base64","decode","getContent","upsertFile","options","editFile","createFile","edit","create","removeFile","remove","getTree","tree","getFileGitUrl","initConfig","getGitByPath","git","gitlabFactory","DataSource","sequelize","define","id","Sequelize","BIGINT","autoIncrement","primaryKey","STRING","allowNull","name","unique","externalUserId","externalPassword","isDefault","BOOLEAN","dbconfig","dialect","operatorsAliases","pool","max","min","acquire","idle","User","set","val","setDataValue","toUpperCase","email","cellphone","nickname","portrait","sex","require","webpack","console","log","resolve","module","exports","srcDir","plugins","src","ssr","head","title","meta","charset","hid","link","rel","href","css","loading","color","build","analyze","vendor","babel","libraryName","styleLibraryName","extend","ctx","entry","optimize","CommonsChunkPlugin","names","minChunks","Infinity","alias","node","fs","tls","net","apiRouter","prefix","apiUrlPrefix","registerControllerRouter","app","views","viewRouter","use","Static","cors","KoaBody","jwt","passthrough","cookie","routes","allowedMethods","GroupsBundler","Pick","UsersBundler","ProjectsBundler","BaseModel","oauthToken","URLJoin","headers","Authorization","Error","services","combined","Object","assign","entries","forEach","Service","defaultRequest","endpoint","method","body","qs","formData","params","Humps","decamelizeKeys","service","axios","resolveWithFullResponse","response","links","LinkParser","page","limit","maxPages","more","next","get","form","from","to","pId","sha","filePath","map","post","put","delete","client","elasticsearch","Client","elasticsearchFactory","urlPrefix","pageSuffix","tagModsPath","port","baseURL","defaultDataSource","model","update","find","getSystemDataSource","cloneDeep","getDefaultDataSource","request","query","authUsername","state","user","findOne","where","dataSource","plain","undefined","getRoutes","action","getGitData","JSON","parse","formatSiteinfoESData","formatUserinfoESData","formatPageinfoESData","formatESDataMap","getGitFileData","yaml","safeLoad","json","e","formatESData","tablename","format","submitESData","item","indexs","index_prefix","version","esData","index","join","res","esClient","webhook","self","commit","commits","project_url","project","http_url","origin","wurl","project_id","external_username","user_username","filelist","dataFileReg","filelistAddItem","oper","test","match","push","each","added","modified","removed","promises","Promise","all","controllers","router","ctrl","route","methods","isArray","lowerCase","validate","requireAuth","status","register","encode","userId","_id","userinfo","login","isLogin","findById","joi","string","required","schema","opt","defaultsDeep","allowUnknown","defaultValidateKeys","needValidateKeys","intersection","keys","errors","toValidateObj","result","error","details","assignIn","msg","dev","env","nuxt","builder","server","reject","on","req","render","promise","catch","_config","listen","start"],"mappings":"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","file":"main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 50);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap b7290dd06d852c21cea7","module.exports = require(\"regenerator-runtime\");\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/babel-runtime/regenerator/index.js\n// module id = 0\n// module chunks = 0","module.exports = require(\"lodash\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash\"\n// module id = 1\n// module chunks = 0","import commonConfig from \"../common/config.js\";\nimport config from \"./prod.config.js\";\n\nconst defaultConfig = {\n\t...commonConfig,\n\n\tgitlabToken: \"18ayouuEsKRo_yM1P5eF\",\n\n\tsecret: \"keepwork\",\n\n\tdatabase: {\n\t\t//port:3306,\n\t\thost: '39.106.11.114',\n\t\ttype: \"mysql\",\n\t\tdatabase: \"keepwork\", // 数据库名\n\t\tusername: \"wuxiangan\",\n\t\tpassword: \"xxxxxx\", \n\t},\n}\n\nconst productionConfig = {\n\t...defaultConfig,\n\t\n\t...config,\n}\n\nconst developmentConfig = {\n\t...defaultConfig,\n\n\t...config,\n}\n\nconst configs = {\n\t\"production\": productionConfig,\n\t\"development\": developmentConfig,\n}\n\nexport default configs[process.env.NODE_ENV];\n\n\n\n// WEBPACK FOOTER //\n// ./server/config.js","\nexport const Err = function(code, message, data) {\n\tthis.code = code || 0;\n\tthis.message = message || \"OK\";\n\tthis.data = data || null; // 请求数据\n}\n\nErr.prototype.setMessage = function(message = \"OK\"){\n\tthis.message = message;\n\treturn this;\n}\n\nErr.prototype.setCode = function(code = 0){\n\tthis.code = code; \n\treturn this;\n}\n\nErr.prototype.setData = function(data){\n\tthis.data = data;\n\treturn this;\n}\n\nexport const ERR = new Err(-1, \"unknown error\");\nexport const ERR_OK = new Err();\nexport const ERR_PARAMS = new Err(1, \"参数错误\");\nexport const ERR_UNATUH = new Err(2, \"未认证\");\nexport const ERR_NOT_FOUND = new Err(3, \"未找到记录\");\n\nexport default {\n\tERR,\n\tERR_OK,\n\tERR_PARAMS,\n\tERR_UNATUH,\n\tERR_NOT_FOUND,\n};\n\n\n\n\n\n\n\n// WEBPACK FOOTER //\n// ./server/common/error.js","module.exports = require(\"joi\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"joi\"\n// module id = 4\n// module chunks = 0","import _BaseService from './BaseService';\nimport _RequestHelper from './RequestHelper';\nimport _Bundler from './Bundler';\n\nexport const BaseService = _BaseService;\nexport const RequestHelper = _RequestHelper;\nexport const Bundler = _Bundler;\n\n\n\n// WEBPACK FOOTER //\n// ./client/lib/gitlab-api/infrastructure/index.js","module.exports = require(\"sequelize\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"sequelize\"\n// module id = 6\n// module chunks = 0","module.exports = require(\"koa\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa\"\n// module id = 7\n// module chunks = 0","//// Groups\n//export Groups from './Groups';\n//export GroupAccessRequests from './GroupAccessRequests';\n//export GroupBadges from './GroupBadges';\n//export GroupCustomAttributes from './GroupCustomAttributes';\n//export GroupIssueBoards from './GroupIssueBoards';\n//export GroupMembers from './GroupMembers';\n//export GroupMilestones from './GroupMilestones';\n//export GroupProjects from './GroupProjects';\n//export GroupVariables from './GroupVariables';\n//export Epics from './Epics';\n//export EpicIssues from './EpicIssues';\n//export EpicNotes from './EpicNotes';\n//export EpicDiscussions from './EpicDiscussions';\n\n//// Users\n//export Users from './Users';\n//export UserEmails from './UserEmails';\n//export UserImpersonationTokens from './UserImpersonationTokens';\n//export UserKeys from './UserKeys';\n//export UserGPGKeys from './UserGPGKeys';\n\n//// Projects\n//export Branches from './Branches';\n//export Commits from './Commits';\n//export Deployments from './Deployments';\n//export DeployKeys from './DeployKeys';\n//export Environments from './Environments';\n//export Issues from './Issues';\n//export IssueNotes from './IssueNotes';\n//export IssueDiscussions from './IssueDiscussions';\n//export IssueAwardEmojis from './IssueAwardEmojis';\n//export Jobs from './Jobs';\n//export Labels from './Labels';\n//export MergeRequests from './MergeRequests';\n//export MergeRequestAwardEmojis from './MergeRequestAwardEmojis';\n//export MergeRequestNotes from './MergeRequestNotes';\n//export Pipelines from './Pipelines';\n//export PipelineSchedules from './PipelineSchedules';\n//export PipelineScheduleVariables from './PipelineScheduleVariables';\n//export Projects from './Projects';\n//export ProjectAccessRequests from './ProjectAccessRequests';\n//export ProjectCustomAttributes from './ProjectCustomAttributes';\n//export ProjectImportExport from './ProjectImportExport';\n//export ProjectIssueBoards from './ProjectIssueBoards';\n//export ProjectHooks from './ProjectHooks';\n//export ProjectMembers from './ProjectMembers';\n//export ProjectMilestones from './ProjectMilestones';\n//export ProjectSnippets from './ProjectSnippets';\n//export ProjectSnippetNotes from './ProjectSnippetNotes';\n//export ProjectSnippetDiscussions from './ProjectSnippetDiscussions';\n//export ProjectSnippetAwardEmojis from './ProjectSnippetAwardEmojis';\n//export ProtectedBranches from './ProtectedBranches';\n//export ProjectVariables from './ProjectVariables';\nimport _Repositories from './Repositories';\nexport const Repositories = _Repositories;\nimport _RepositoryFiles from './RepositoryFiles';\nexport const RepositoryFiles = _RepositoryFiles; \n//export Runners from './Runners';\n//export Services from './Services';\n//export Tags from './Tags';\n//export Todos from './Todos';\n//export Triggers from './Triggers';\n\n//// General\n//export ApplicationSettings from './ApplicationSettings';\n//export BroadcastMessages from './BroadcastMessages';\n//export Events from './Events';\n//export FeatureFlags from './FeatureFlags';\n//export GeoNodes from './GeoNodes';\n//export GitignoreTemplates from './GitignoreTemplates';\n//export GitLabCIYMLTemplates from './GitLabCIYMLTemplates';\n//export Keys from './Keys';\n//export Licence from './Licence';\n//export LicenceTemplates from './LicenceTemplates';\n//export Lint from './Lint';\n//export Namespaces from './Namespaces';\n//export NotificationSettings from './NotificationSettings';\n//export PagesDomains from './PagesDomains';\n//export Search from './Search';\n//export SidekiqMetrics from './SidekiqMetrics';\n//export SystemHooks from './SystemHooks';\n//export Wikis from './Wikis';\n\n\n\n// WEBPACK FOOTER //\n// ./client/lib/gitlab-api/services/index.js","import gitlabApi from \"../../client/lib/gitlab-api\";\n//import gitlabApi from \"node-gitlab-api\";\nimport {Base64} from \"js-base64\";\nimport _ from \"lodash\";\n\n\nconst defaultUsername = \"keepwork\";\n\nconst defaultConfig = {\n\tapiBaseUrl:\"https://gitlab.com\",\n\trawBaseUrl:\"https://gitlab.com\",\n\ttoken:\"Ed9S7hSfiruewMR-jitR\",\n\tref:\"master\",\n\tbranch:\"master\",\n\tprojectId:4980659,\n\t//rootPath:\"xiaoyao\",\n};\n\nconst xiaoyaoConfig = {\n\tusername:\"xiaoyao\",\n\tprojectId: 4980659,\n\texternalUsername: \"wxaxiaoyao\",\n\tprojectName: \"keepworkdatasource\",\n\ttoken:\"Ed9S7hSfiruewMR-jitR\",\n\tref: \"master\",\n\tbranch: \"master\",\n}\n\nconst keepworkConfig = {\n\tusername:\"keepwork\",\n\texternalUsername: \"keepwork\",\n\tprojectName: \"keepworkdatasource\",\n\thost:\"https://gitlab.com\",\n\ttoken:\"9x94xLa-CZPH9Da5h5kd\",\n\tref:\"master\",\n\tbranch: \"master\",\n\tprojectId:5112836,\n}\n\nconst gitlab = {\n\tgits:{\n\n\t}\n}\n\nconst encodeUrl = function(url) {\n\treturn encodeURIComponent(url).replace(/\\./g,'%2E')\n}\n\nconst getUsernameByPath = function(path) {\n\tconst paths = (path || \"\").split(\"/\");\n\tlet username = \"keepwork\";\n\tfor (let i = 0; i < paths.length; i++) {\n\t\tif (paths[i]) {\n\t\t\tusername = paths[i];\n\t\t\tbreak;\n\t\t}\n\t}\n\n\tusername = username.replace(/_(data|files)$/, \"\");\n\n\treturn username;\n}\n\nfunction Gitlab(config){\n\tconfig = _.mapKeys(config || {}, (value, key) => _.camelCase(key));\n\tthis.cfg = {\n\t\t...defaultConfig,\n\t\t...((gitlab.gits[config.username] || {}).cfg || {}),\n\t\t...(config || {}),\n\t};\n\t//console.log(cfg);\n\t\n\tconst gitcfg = {url: this.cfg.rawBaseUrl, token: this.cfg.token};\n\t//this.api = {\n\t\t////RepositoryFiles: new RepositoryFiles(gitcfg),\n\t\t////Repositories: new Repositories(gitcfg),\n\t//}\n\tthis.api = new gitlabApi({url:this.cfg.rawBaseUrl, token:this.cfg.token});\n\t//return this;\n}\n\nGitlab.prototype.getFile = function(path) {\n\treturn this.api.RepositoryFiles.show(this.cfg.projectId, path, this.cfg.ref).then(file => {\n\t\tfile.content = Base64.decode(file.content);\n\t\treturn file;\n\t});\n}\n\nGitlab.prototype.getContent = function(path) {\n\treturn this.api.RepositoryFiles.show(this.cfg.projectId, path, this.cfg.ref).then(file => Base64.decode(file.content));\n}\n\nGitlab.prototype.upsertFile = function(path, options) {\n\tconst file = this.getFile(path);\n\treturn file ? this.editFile(path, options) : this.createFile(path, options);\n}\n\nGitlab.prototype.editFile = function(path, options) {\n\treturn this.api.RepositoryFiles.edit(this.cfg.projectId, path, this.cfg.branch, options);\n}\n\nGitlab.prototype.createFile = function(path, options) {\n\treturn this.api.RepositoryFiles.create(this.cfg.projectId, path, this.cfg.branch, options);\n}\n\nGitlab.prototype.removeFile = function(path, options) {\n\treturn this.api.RepositoryFiles.remove(this.cfg.projectId, path, this.cfg.branch, options);\n}\n\nGitlab.prototype.getTree = function(path, options) {\n\toptions = options || {};\n\toptions.path = path;\n\n\treturn this.api.Repositories.tree(this.cfg.projectId, options);\n}\n\nGitlab.prototype.getFileGitUrl = function(path) {\n\tconst url = this.cfg.rawBaseUrl + \"/\" + this.cfg.externalUsername + \"/\" + this.cfg.projectName + '/blob/' + \"master\" + '/' + path;\n\t\n\treturn url;\n}\n\ngitlab.initConfig = function(config){\n\tif (!config || !config.username) {\n\t\treturn;\n\t}\n\t\n\tthis.gits[config.username] = new Gitlab(config);\n}\n\ngitlab.getGitByPath = function(path) {\n\tconst username = getUsernameByPath(path);\n\treturn this.gits[username] || this.gits[defaultUsername];\n}\n\ngitlab.getContent = function(path) {\n\treturn this.getGitByPath(path).getContent(path);\n}\n\ngitlab.getFile = function(path) {\n\treturn this.getGitByPath(path).getFile(path);\n}\n\ngitlab.editFile = function(path, options) {\n\tconst git = this.getGitByPath(path);\n\treturn git.editFile(path, options);\n}\n\ngitlab.createFile = function(path, options) {\n\tconst git = this.getGitByPath(path);\n\t//path = encodeUrl(path);\n\treturn git.createFile(path, options);\n}\n\ngitlab.removeFile = function(path, options) {\n\tconst git = this.getGitByPath(path);\n\treturn git.removeFile(path, options);\n}\n\ngitlab.getTree = function(path, options) {\n\tconst git = this.getGitByPath(path);\n\treturn git.getTree(path, options);\n}\n\ngitlab.getFileGitUrl = function(path) {\n\treturn this.getGitByPath(path).getFileGitUrl(path);\n}\n\ngitlab.initConfig(keepworkConfig);\ngitlab.initConfig(xiaoyaoConfig);\n\nexport const gitlabFactory = (config) => new Gitlab(config);\nexport default gitlab;\n\n\n\n// WEBPACK FOOTER //\n// ./common/api/gitlab.js","import Sequelize from 'sequelize';\nimport sequelize from \"./database.js\";\n\nconst DataSource = sequelize.define(\"dataSource\", {\n\tid: {\n\t\ttype: Sequelize.BIGINT,\n\t\tautoIncrement: true,\n\t\tprimaryKey: true,\n\t},\n\n\tusername: {\n\t\ttype: Sequelize.STRING(48),\n\t\tallowNull: false,\n\t},\n\n\tname: {\n\t\ttype: Sequelize.STRING(48),\n\t\tunique: true,\n\t},\n\n\ttype: {\n\t\ttype: Sequelize.STRING(12),\n\t},\n\n\ttoken: {\n\t\ttype: Sequelize.STRING(128),\n\t\t//allowNull, false,\n\t},\n\n\tapiBaseUrl: {\n\t\ttype: Sequelize.STRING(64),\n\t},\n\n\trawBaseUrl: {\n\t\ttype: Sequelize.STRING(64),\n\t},\n\n\texternalUserId: {\n\t\ttype: Sequelize.BIGINT,\n\t},\n\n\texternalUsername: {\n\t\ttype: Sequelize.STRING(48),\n\t},\n\n\texternalPassword: {\n\t\ttype: Sequelize.STRING(128),\n\t},\n\t\n\tisDefault: {\n\t\ttype: Sequelize.BOOLEAN,\n\t},\n});\n\n//DataSource.sync({force:true}).then(() => {\n\t//console.log(\"create dataSource table successfully\");\n//});\n\nexport default DataSource;\n\n\n\n// WEBPACK FOOTER //\n// ./server/models/dataSource.js","import Sequelize from 'sequelize';\nimport config from \"../config.js\";\n\nconst dbconfig = config.database;\n\nconst sequelize = new Sequelize(dbconfig.database, dbconfig.username, dbconfig.password, {\n  host: dbconfig.host,\n  dialect: dbconfig.type,\n  operatorsAliases: false,\n\n  pool: {\n    max: 5,\n    min: 0,\n    acquire: 30000,\n    idle: 10000\n  },\n\n  // SQLite only\n  //storage: 'path/to/database.sqlite'\n});\n\n//sequelize\n  //.authenticate()\n  //.then(() => {\n    //console.log('Connection has been established successfully.');\n  //})\n  //.catch(err => {\n    //console.error('Unable to connect to the database:', err);\n  //});\n\nexport default sequelize;\n\n\n\n// WEBPACK FOOTER //\n// ./server/models/database.js","import Sequelize from 'sequelize';\nimport sequelize from \"./database.js\";\n\nconst User = sequelize.define('user', {\n\tid: {\n\t\ttype: Sequelize.BIGINT,\n\t\tautoIncrement: true,\n\t\tprimaryKey: true,\n\t},\n\t\n\tusername: {\n\t\ttype: Sequelize.STRING(48),\n\t\tunique: true,\n\t},\n\n\tpassword: {\n\t\ttype: Sequelize.STRING(48),\n\n\t\tset(val) {\n\t\t\tthis.setDataValue(\"password\", val.toUpperCase());\n\t\t},\n\t},\n\n\temail: {\n\t\ttype: Sequelize.STRING(24),\n\t\tunique: true,\n\t},\n\n\tcellphone: {\n\t\ttype: Sequelize.STRING(24),\n\t\tunique: true,\n\t},\n\n\tnickname: {\n\t\ttype: Sequelize.STRING,\n\t},\n\n\tportrait: {\n\t\ttype: Sequelize.STRING,\n\t},\n\n\tsex: {\n\t\ttype: Sequelize.STRING(4),\n\t},\n});\n\n//User.sync({force:true}).then(() => {\n\t//console.log(\"create user table successfully\");\n//});\n\n\nexport default User;\n\n\n\n// WEBPACK FOOTER //\n// ./server/models/user.js","module.exports = require(\"jwt-simple\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"jwt-simple\"\n// module id = 13\n// module chunks = 0","module.exports = require(\"url-join\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"url-join\"\n// module id = 14\n// module chunks = 0","module.exports = require(\"wurl\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"wurl\"\n// module id = 15\n// module chunks = 0","const path = require(\"path\");\nconst webpack = require(\"webpack\");\n\nconsole.log(path.resolve(\".\"));\nmodule.exports = {\n\tsrcDir: \"client/\",\n\n\tplugins: [\n\t{src:\"~/plugins/app\", ssr: false},\n\t{src:\"~/plugins/persistedstate\", ssr: false},\n\t{src:\"~/plugins/codemirror\", ssr: false},\n\t{src:\"~/plugins/element-ui\"},\n\t//{src:\"~/plugins/test\", ssr: false},\n\t],\n\n\t/*\n  \t** Headers of the page\n  \t*/\n  \thead: {\n\t\ttitle: 'starter',\n  \t  \tmeta: [\n\t\t\t{ charset: 'utf-8' },\n  \t  \t  \t{ name: 'viewport', content: 'width=device-width, initial-scale=1' },\n  \t  \t  \t{ hid: 'description', name: 'description', content: 'Nuxt.js project' }\n  \t  \t],\n  \t  \tlink: [\n\t\t\t{ rel: 'icon', type: 'image/x-icon', href: '/favicon.ico' }\n  \t  \t]\n  \t},\n  \t/*\n  \t** Global CSS\n  \t*/\n  \tcss: [\n\t\t'font-awesome/css/font-awesome.min.css',\n\t\t'~assets/css/main.css'\n\t],\n  \t/*\n  \t** Customize the progress-bar color\n  \t*/\n  \tloading: { color: '#3B8070' },\n  \t/*\n  \t ** Build configuration\n  \t */\n  \tbuild: {\n\t\tanalyze: true,\n\t\tvendor: [\n\t\t\t\"lodash\",\n\t\t\t\"axios\",\n\t\t\t\"vuex-persistedstate\",\n\t\t],\n\t\tbabel: {\n\t\t\t//presets:[\n\t\t\t//],\n\t\t\tplugins:[\n\t\t\t\t\"syntax-dynamic-import\",\n\t\t\t\t[\n\t\t\t\t\t\"component\",\n\t\t\t\t\t{\n\t\t\t\t\t\tlibraryName:\"element-ui\",\n\t\t\t\t\t\tstyleLibraryName:\"theme-chalk\",\n\t\t\t\t\t},\n\t\t\t\t\t'transform-async-to-generator',\n\t\t\t\t\t'transform-runtime',\n\t\t\t\t],\n\t\t\t],\n\t\t},\n  \t  \textend (config, ctx) {\n\t\t\tif (config.name == \"server\") {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconfig.entry[\"codemirror\"] = [\"~/plugins/codemirror\"];\n\t\t\tconfig.entry[\"elementUI\"] = [\"~/plugins/element-ui\"];\n\t\t\tconfig.plugins[0] = new webpack.optimize.CommonsChunkPlugin({\n\t\t\t\t//name:\"vendor\",\n\t\t\t\tnames: [\"elementUI\", \"codemirror\", \"vendor\"],\n\t\t\t\t//chunks: [\"lodash\", \"axios\"],\n\t\t\t\tminChunks: Infinity,\n\t\t\t});\n\n\t\t\tconfig.resolve.alias[\"vue$\"] = \"vue/dist/vue.esm.js\";\n\t\t\t//config.resolve.alias[\"gitlabapi$\"] = \"~/lib/gitlab-api/index.js\";\n\t\t\t//console.log(config.resolve.alias);\n\t\t\tconfig.node = {\n\t\t\t\t...(config.node || {}),\n\t\t\t\tfs: \"empty\",\n\t\t\t\ttls: \"empty\",\n  \t  \t\t\tnet: \"empty\",\n  \t  \t\t};\n  \t  \t}\n  \t}\n}\n\n\n\n// WEBPACK FOOTER //\n// ./nuxt.config.js","import Koa from \"koa\";\nimport cors from \"@koa/cors\";\nimport jwt from \"koa-jwt\";\nimport Router from \"koa-router\";\nimport KoaBody from \"koa-body\";\nimport Static from \"koa-static\";\nimport wurl from \"wurl\";\nimport _ from \"lodash\";\n\nimport registerControllerRouter from \"./controllers/index.js\";\n\n//import log from \"./log.js\";\nimport config from \"./config.js\";\nimport models from \"./models/index.js\";\n\nconst apiRouter = new Router({\n\tprefix: config.apiUrlPrefix,\n});\nregisterControllerRouter(apiRouter);\n\n\nexport default (app, views) => {\n\tconst viewRouter = new Router({});\n\t//viewRouter.get(\"/www/*\", views);\n\n\tapp\n\t.use(Static(\"../.nuxt/\"))\n\t.use(cors())\n\t.use(KoaBody())\n\t.use(jwt({secret:config.secret, passthrough:true, cookie:\"token\"}))\n\t.use(apiRouter.routes())\n\t.use(apiRouter.allowedMethods())\n\t.use(viewRouter.routes());\n}\n\n\n\n\n// WEBPACK FOOTER //\n// ./server/server.js","module.exports = require(\"nuxt\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"nuxt\"\n// module id = 18\n// module chunks = 0","import Pick from 'lodash.pick';\nimport * as APIServices from './services';\nimport { Bundler } from './infrastructure';\n\n// All seperatly\nexport * from './services';\n\n// Groups\nexport const GroupsBundler = Bundler(Pick(APIServices, [\n  'Groups',\n  'GroupAccessRequests',\n  'GroupBadges',\n  'GroupCustomAttributes',\n  'GroupIssueBoards',\n  'GroupMembers',\n  'GroupMilestones',\n  'GroupProjects',\n  'GroupVariables',\n  'Epics',\n  'EpicIssues',\n  'EpicNotes',\n  'EpicDiscussions',\n]));\n\n// Users\nexport const UsersBundler = Bundler(Pick(APIServices, [\n  'Users',\n  'UserEmails',\n  'UserImpersonationTokens',\n  'UserKeys',\n  'UserGPGKeys',\n]));\n\n// Projects\nexport const ProjectsBundler = Bundler(Pick(APIServices, [\n  'Branches',\n  'Commits',\n  'DeployKeys',\n  'Deployments',\n  'Environments',\n  'Issues',\n  'IssueAwardEmojis',\n  'IssueNotes',\n  'IssueDiscussions',\n  'Jobs',\n  'Labels',\n  'MergeRequests',\n  'MergeRequestAwardEmojis',\n  'MergeRequestNotes',\n  'Pipelines',\n  'PipelineSchedules',\n  'PipelineScheduleVariables',\n  'Projects',\n  'ProjectAccessRequests',\n  'ProjectBadges',\n  'ProjectCustomAttributes',\n  'ProjectImportExport',\n  'ProjectIssueBoards',\n  'ProjectHooks',\n  'ProjectMembers',\n  'ProjectMilestones',\n  'ProjectSnippet',\n  'ProjectSnippetNotes',\n  'ProjectSnippetDiscussions',\n  'ProjectSnippetAwardEmojis',\n  'ProtectedBranches',\n  'ProjectVariables',\n  'Repositories',\n  'RepositoryFiles',\n  'Runners',\n  'Services',\n  'Tags',\n  'Triggers',\n]));\n\n// All initialized\nexport default Bundler(APIServices);\n\n\n\n// WEBPACK FOOTER //\n// ./client/lib/gitlab-api/index.js","import URLJoin from 'url-join';\n\nclass BaseModel {\n  constructor({ url = 'https://gitlab.com', token, oauthToken }) {\n    this.url = URLJoin(url, 'api', 'v4');\n    this.headers = {};\n\n    if (oauthToken) {\n      this.headers.Authorization = `Bearer ${oauthToken}`;\n    } else if (token) {\n      this.headers['private-token'] = token;\n    } else {\n      throw new Error('`token` (private-token) or `oauth_token` is mandatory');\n    }\n  }\n}\n\nexport default BaseModel;\n\n\n\n// WEBPACK FOOTER //\n// ./client/lib/gitlab-api/infrastructure/BaseService.js","function Bundler(...services) {\n  const combined = Object.assign({}, ...services);\n\n  return class Bundle {\n    constructor(options) {\n      Object.entries(combined).forEach(([name, Service]) => {\n        this[name] = new Service(options);\n      });\n    }\n  };\n}\n\nexport default Bundler;\n\n\n\n// WEBPACK FOOTER //\n// ./client/lib/gitlab-api/infrastructure/Bundler.js","//import Request from 'request-promise';\nimport axios from \"axios\";\nimport Humps from 'humps';\nimport LinkParser from 'parse-link-header';\nimport URLJoin from 'url-join';\n\nfunction defaultRequest(\n  url,\n  endpoint,\n  { method, headers, body, qs, formData},\n) {\n  const params = {\n    url: URLJoin(url, endpoint),\n\tmethod,\n    headers,\n  };\n\n  if (body) params.data = Humps.decamelizeKeys(body);\n  if (qs) params.params = Humps.decamelizeKeys(qs);\n  if (formData) params.data = formData;\n\n\n  return params;\n}\n\nclass RequestHelper {\n  static async get(service, endpoint, options = {}) {\n    const response = await axios(defaultRequest(service.url, endpoint, {\n\t  method: \"get\",\n      headers: service.headers,\n      qs: options,\n      resolveWithFullResponse: true,\n    }));\n\n    const links = LinkParser(response.headers.link);\n    const page = response.headers['x-page'];\n    const limit = options.maxPages ? page < options.maxPages : true;\n    let more = [];\n\n    if (page && limit && links.next) {\n      more = await RequestHelper.get(service, links.next.url.replace(service.url, ''), options);\n\n      return [...response.data, ...more];\n    }\n\n    return response.data;\n  }\n\n  static post(service, endpoint, options = {}, form = false) {\n    const body = form ? 'fromData' : 'body';\n\n    return axios(defaultRequest(service.url, endpoint, {\n\t  method: \"post\",\n      headers: service.headers,\n      [body]: options,\n    }));\n  }\n\n  static put(service, endpoint, options = {}) {\n    return axios(defaultRequest(service.url, endpoint, {\n\t  method: \"put\",\n      headers: service.headers,\n      body: options,\n    }));\n  }\n\n  static delete(service, endpoint, options = {}) {\n    return axios(defaultRequest(service.url, endpoint, {\n\t  method: \"delete\",\n      headers: service.headers,\n      qs: options,\n    }));\n  }\n}\n\nexport default RequestHelper;\n\n\n\n// WEBPACK FOOTER //\n// ./client/lib/gitlab-api/infrastructure/RequestHelper.js","import { BaseService, RequestHelper } from '../infrastructure';\n\nclass Repositories extends BaseService {\n  compare(projectId, from, to) {\n    const pId = encodeURIComponent(projectId);\n\n    return RequestHelper.get(this, `projects/${pId}/repository/compare`, {\n      from,\n      to,\n    });\n  }\n\n  contributors(projectId) {\n    const pId = encodeURIComponent(projectId);\n\n    return RequestHelper.get(this, `projects/${pId}/repository/contributors`);\n  }\n\n  showArchive(projectId, { sha }) {\n    const pId = encodeURIComponent(projectId);\n\n    return RequestHelper.get(this, `projects/${pId}/repository/archive`, {\n      sha,\n    });\n  }\n\n  showBlob(projectId, sha) {\n    const pId = encodeURIComponent(projectId);\n\n    return RequestHelper.get(this, `projects/${pId}/repository/blobs/${sha}`);\n  }\n\n  showBlobRaw(projectId, sha) {\n    const pId = encodeURIComponent(projectId);\n\n    return RequestHelper.get(this, `projects/${pId}/repository/blobs/${sha}/raw`);\n  }\n\n  tree(projectId, options) {\n    const pId = encodeURIComponent(projectId);\n\n    return RequestHelper.get(this, `projects/${pId}/repository/tree`, options);\n  }\n}\n\nexport default Repositories;\n\n\n\n// WEBPACK FOOTER //\n// ./client/lib/gitlab-api/services/Repositories.js","import { BaseService, RequestHelper } from '../infrastructure';\n\nclass RepositoryFiles extends BaseService {\n  create(projectId, filePath, branch, options) {\n    const [pId, path] = [projectId, filePath].map(encodeURIComponent);\n\n    return RequestHelper.post(this, `projects/${pId}/repository/files/${path}`, {\n      branch,\n      ...options,\n    });\n  }\n\n  edit(projectId, filePath, branch, options) {\n    const [pId, path] = [projectId, filePath].map(encodeURIComponent);\n\n    return RequestHelper.put(this, `projects/${pId}/repository/files/${path}`, {\n      branch,\n      ...options,\n    });\n  }\n\n  remove(projectId, filePath, branch, options) {\n    const [pId, path] = [projectId, filePath].map(encodeURIComponent);\n\n    return RequestHelper.delete(this, `projects/${pId}/repository/files/${path}`, {\n      branch,\n      ...options,\n    });\n  }\n\n  show(projectId, filePath, ref) {\n    const [pId, path] = [projectId, filePath].map(encodeURIComponent);\n\n    return RequestHelper.get(this, `projects/${pId}/repository/files/${path}`, {\n      ref,\n    });\n  }\n\n  showRaw(projectId, filePath, ref) {\n    const [pId, path] = [projectId, filePath].map(encodeURIComponent);\n\n    return RequestHelper.get(this, `projects/${pId}/repository/files/${path}/raw`, { ref });\n  }\n}\n\nexport default RepositoryFiles;\n\n\n\n// WEBPACK FOOTER //\n// ./client/lib/gitlab-api/services/RepositoryFiles.js","\nimport elasticsearch from \"elasticsearch\";\n\nconst defaultConfig = {\n\thost: \"http://10.28.18.7:9200\",\n}\n\nconst client = new elasticsearch.Client({\n\t...defaultConfig,\n});\n\nexport const elasticsearchFactory = (config) => {\n\treturn new elasticsearch.Client({\n\t\t...defaultConfig,\n\t\t...(config || {}),\n\t});\n}\n\nexport default client;\n\n\n\n// WEBPACK FOOTER //\n// ./common/api/elasticSearch.js","\nconst config = {\n\turlPrefix: \"wiki\",\n\tapiUrlPrefix: \"/api/v0\",\n\tpageSuffix:\".md\",\n\ttagModsPath: \"keepwork_data/tag_mods.json\",\n\n\thost: \"127.0.0.1\",\n\tport: 3000,\n}\n\nconfig.baseURL = \"http://\" + config.host + \":\" + config.port + config.apiUrlPrefix;\n\nexport default config;\n\n\n\n// WEBPACK FOOTER //\n// ./common/config.js","import _ from \"lodash\";\nimport joi from \"joi\";\nimport jwt from \"jwt-simple\";\n\nimport config from \"../config.js\";\nimport ERR from \"../common/error.js\";\nimport DataSourceModel from \"../models/dataSource.js\";\n\nconst defaultDataSource = {\n\tusername:\"keepwork\",\n\texternalUsername: \"keepwork\",\n\tprojectName: \"keepworkdatasource\",\n\thost:\"https://gitlab.com\",\n\ttoken:\"9x94xLa-CZPH9Da5h5kd\",\n\tref:\"master\",\n\tbranch: \"master\",\n\tprojectId:5112836,\n}\n\nexport const DataSource = function() {\n\tthis.model = DataSourceModel;\n}\n\nDataSource.prototype.create = function() {\n\n} \n\nDataSource.prototype.update = function() {\n\n}\n\nDataSource.prototype.delete = function() {\n\n}\n\nDataSource.prototype.find = function() {\n\n}\n\nDataSource.prototype.getSystemDataSource = function() {\n\treturn _.cloneDeep(defaultDataSource);\n}\n\n// 获取用户默认数据源\nDataSource.prototype.getDefaultDataSource = async function(ctx) {\n\tconst params = ctx.request.query;\n\tconst authUsername = ctx.state.user.username;\n\tconst username = params.username || authUsername;\n\n\tif (!username) return ERR.ERR_PARAMS;\n\t\n\tlet dataSource = await this.model.findOne({\n\t\twhere: {\n\t\t\tusername: username,\n\t\t\tisDefault: true,\n\t\t},\n\t});\n\n\tif (!dataSource) return ERR.ERR_NOT_FOUND;\n\n\tdataSource = dataSource.get({plain:true});\n\n\tif (username != authUsername) {\n\t\tdataSource.token = undefined;\n\t\tdataSource.externalPassword = undefined;\n\t}\n\n\treturn dataSource;\n}\n\nDataSource.prototype.getRoutes = function() {\n\tconst prefix = \"/dataSource\";\n\tconst routes = [\n\t{\n\t\tpath: prefix + \"/getDefaultDataSource\",\n\t\tmethod: \"get\",\n\t\taction: \"getDefaultDataSource\",\n\t},\n\t];\n\n\treturn routes;\n}\n\nexport default new DataSource();\n\n\n\n// WEBPACK FOOTER //\n// ./server/controllers/dataSource.js","import _ from \"lodash\";\nimport joi from \"joi\";\nimport wurl from \"wurl\";\nimport yaml from \"js-yaml\";\n\nimport ERR from \"../common/error.js\";\nimport config from \"../config.js\";\nimport esClient from \"../../common/api/elasticSearch.js\";\nimport {gitlabFactory} from \"../../common//api/gitlab.js\";\nimport gitlab from \"../../common/api/gitlab.js\";\n//import {gitlabFactory} from \"../../vue/src//api/gitlab.js\";\n\n// 获取GIT的ES数据\nconst getGitData = async function(git, path) {\n\ttry {\n\t\tconst content = await git.getContent(path);\n\t\tconst data = JSON.parse(content);\n\t\treturn data;\n\t} catch (e){\n\t\tconsole.log(e);\n\t}\n\treturn;\n} \n\nconst formatSiteinfoESData = function(data) {\n\n}\n\nconst formatUserinfoESData = function(data) {\n\n}\n\nconst formatPageinfoESData = function(data) {\n\n}\n\nconst formatESDataMap = {\n\t\"userinfo\": formatUserinfoESData,\n\t\"siteinfo\": formatSiteinfoESData,\n\t\"pageinfo\": formatPageinfoESData,\n}\n\nexport const Gitlab = function() {\n\t\n}\n\n// 获取git文件中的数据信息\nGitlab.prototype.getGitFileData = function(content) {\n\ttry {\n\t\t//return Json.parse(content);\n\t\treturn yaml.safeLoad(content, {json:true});\n\t} catch(e) {\n\t\tconsole.log(e);\n\t}\n\n\treturn ;\n}\n\nGitlab.prototype.formatESData = function(data, tablename) {\n\tdata = _.cloneDeep(data || {});\n\tconst format = formatESDataMap[tablename];\n\n\tformat && format(data);\n\n\treturn data;\n}\n\nGitlab.prototype.submitESData = async function(item) {\n\tconst data = item.data || {};\n\tconst tablename = item.tablename;\n\tconst path = item.path;\n\tconst action = item.action;\n\tconst indexs = [data.index_prefix || \"kw\", tablename, data.version || \"v0\"];\n\tconst esData = {\n\t\tindex: indexs.join(\"_\"),\n\t\ttype: tablename,\n\t\tid: path.replace(/\\//g, \"_\"),\n\t\tbody: data.data || {},\n\t}\n\tesData.body.path = path;\n\n\tlet res = null;\n\ttry {\n\t\t//console.log(item, esData);\n\t\tres = await (esClient[action])(esData);\n\t} catch(e) {\n\t\tconsole.log(e);\n\t}\n\t//console.log(res);\n}\n\nGitlab.prototype.webhook = async function(ctx) {\n\tconst self = this;\n\tconst params = ctx.request.body;\n\tconst commit = params.commits[0];\n\tconst project_url = params.project.http_url;\n\tconst origin = wurl(\"protocol\", project_url) + \"://\" + wurl(\"hostname\", project_url);\n\tconst gitcfg = {\n\t\trawBaseUrl:origin,\n\t\tproject_id:params.project_id,\n\t\texternal_username: params.user_username,\n\t\tusername:\"xiaoyao\",\t\n\t\ttoken:config.gitlabToken,\n\t}\n\tconst git = gitlabFactory(gitcfg);\n\t\n\t// 取出文件列表\n\tconst filelist = [];\n\tconst dataFileReg = /^[\\w\\d]+_data\\/([_\\w]+)\\/.+\\.yaml$/;\n\tconst filelistAddItem = (path, oper, action) => {\n\t\tif (!dataFileReg.test(path)) return;\n\t\t\n\t\tconst tablename = path.match(dataFileReg)[1];\n\t\t\n\t\tfilelist.push({\n\t\t\tpath:path, \n\t\t\ttablename:tablename,\n\t\t\toper:oper,\n\t\t\taction:action,\n\t\t});\n\t}\n\n\t_.each(params.commits, commit => {\n\t\t_.each(commit.added, (path) => filelistAddItem(path, \"added\", \"index\"));\n\t\t_.each(commit.modified, (path) => filelistAddItem(path, \"modified\", \"index\"));\n\t\t_.each(commit.removed, (path) => filelistAddItem(path, \"removed\", \"delete\"));\n\t});\n\n\tconst promises = [];\n\t_.each(filelist, (item) => {\n\t\tpromises.push(git.getContent(item.path).then(content => {\n\t\t\titem.content = content;\n\t\t\titem.data = self.getGitFileData(content) || {};\n\t\t\t//console.log(item);\n\t\t\t//item.esData = self.formatESData(item.data),\n\t\t}));\n\t});\n\n\tawait Promise.all(promises);\n\n\t//console.log(filelist);\n\t_.each(filelist, file => self.submitESData(file));\n\n\treturn ;\n}\n\n// 提供接口 写git es\nGitlab.prototype.gitlab = async (ctx) => {\n\tconst params = ctx.request.body;\n\n\tif (!params.git || !params.git.projectId || !params.path || !params.data) return ERR.ERR_PARAMS;\n\n\tconst gitcfg = params.git;\n\tgitcfg.token = gitcfg.token || config.gitlabToken;\n\tconst git = gitlabFactory(gitcfg);\n\n\tgit.upsertFile();\n}\n\nGitlab.prototype.getRoutes = function() {\n\tconst prefix = \"/gitlab\";\n\tconst routes = [\n\t{\n\t\tpath: prefix + \"/webhook\",\n\t\tmethod: \"post\",\n\t\taction: \"webhook\",\n\t},\n\t];\n\n\treturn routes;\n}\n\nexport default new Gitlab();\n\n\n\n// WEBPACK FOOTER //\n// ./server/controllers/gitlab.js","import _ from \"lodash\";\nimport {validate} from \"../middlewares/index.js\";\n\nimport {ERR_UNATUH} from \"../common/error.js\";\n\nimport user from \"./user.js\";\nimport dataSource from \"./dataSource.js\";\nimport gitlab from \"./gitlab.js\"; \n\nexport const controllers = {\n\tuser,\n\tdataSource,\n\tgitlab,\n}\n\nexport const registerControllerRouter = function(router) {\n\t_.each(controllers, ctrl => {\n\t\t_.each(ctrl.getRoutes(), (route) => {\n\t\t\tconst methods = _.isArray(route.method) ? route.method : [route.method || \"get\"];\n\t\t\t_.each(methods, method => {\n\t\t\t\tmethod = _.lowerCase(method);\n\t\t\t\t//console.log(method, route.path);\n\t\t\t\trouter[method](route.path, validate(route.validate), async (ctx, next) => {\n\t\t\t\t\t// 认证中间件\n\t\t\t\t\tif (route.requireAuth && !ctx.state.user) {\n\t\t\t\t\t\tctx.body = ERR_UNATUH;\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tctx.state.user = ctx.state.user || {};\n\n\t\t\t\t\ttry {\n\t\t\t\t\t\tconst body = await ctrl[route.action](ctx);\t\n\t\t\t\t\t\tctx.body = body || ctx.body;\n\t\t\t\t\t} catch(e) {\n\t\t\t\t\t\tconsole.log(e);\n\t\t\t\t\t\tctx.status = 500;\n\t\t\t\t\t\tctx.body = \"请求无法处理\";\n\t\t\t\t\t}\n\t\t\t\t\t//console.log(ctx.body);\n\t\t\t\t});\n\t\t\t})\n\t\t\t\n\t\t})\n\t});\n\n\trouter.all(\"/*\", (ctx, next) => {\n\t\tctx.status = 404;\n\t});\n}\n\nexport default registerControllerRouter;\n\n\n\n// WEBPACK FOOTER //\n// ./server/controllers/index.js","import _ from \"lodash\";\nimport joi from \"joi\";\nimport jwt from \"jwt-simple\";\n\nimport config from \"../config.js\";\nimport {ERR, ERR_OK} from \"../common/error.js\";\nimport userModel from \"../models/user.js\";\n\nexport const User = function() {\n\tthis.model = userModel;\n}\n\nUser.prototype.create = function() {\n\n} \n\nUser.prototype.update = function() {\n\n}\n\nUser.prototype.delete = function() {\n\n}\n\nUser.prototype.find = function() {\n\n}\n\nUser.prototype.register = async function(ctx) {\n\tconst params = ctx.request.body;\n\tlet user = await this.model.findOne({\n\t\twhere: {\n\t\t\tusername: params.username,\n\t\t},\n\t});\n\t\n\tif (user) \treturn ERR.setMessage(\"用户已存在\");\n\n\tuser = await this.model.create({\n\t\tusername: params.username,\n\t\tpassword: params.password,\n\t});\n\n\tif (!user) return ERR;\n\n\treturn ERR_OK.setData({\n\t\ttoken: jwt.encode({\n\t\t\tuserId: user._id, \n\t\t\tusername: user.username\n\t\t}, config.secret),\n\t\tuserinfo: user,\n\t});\n}\n\nUser.prototype.login = async function(ctx) {\n\tconst params = ctx.request.body;\n\tlet user = await this.model.findOne({\n\t\twhere: {\n\t\t\tusername: params.username,\n\t\t\tpassword: params.password,\n\t\t},\n\t});\n\t\n\tif (!user) {\n\t\treturn ERR.setMessage(\"用户名或密码错误\");\n\t}\n\n\tuser = user.get({plain:true});\n\n\n\treturn ERR_OK.setData({\n\t\ttoken: jwt.encode({\n\t\t\tuserId: user._id, \n\t\t\tusername: user.username\n\t\t}, config.secret),\n\t\tuserinfo: user,\n\t});\n}\n\nUser.prototype.isLogin = async function(ctx) {\n\tthis.model.findById(1);\n\treturn \"hello world\";\n}\n\nUser.prototype.getRoutes = function() {\n\tconst self = this;\n\tconst prefix = \"/user\";\n\tconst routes = [\n\t{\n\t\tpath: prefix + \"/register\",\n\t\tmethod: \"post\",\n\t\taction: \"register\",\n\t\tvalidate: {\n\t\t\tbody: {\n\t\t\t\tusername: joi.string().min(4).max(48).required(),\n\t\t\t\tpassword: joi.string().min(4).max(48).required(),\n\t\t\t},\n\t\t}\n\t},\n\n\t{\n\t\tpath: prefix + \"/login\",\n\t\tmethod: \"post\",\n\t\taction: \"login\",\n\t\tvalidate: {\n\t\t\tbody: {\n\t\t\t\tusername: joi.string().min(4).max(48).required(),\n\t\t\t\tpassword: joi.string().min(4).max(48).required(),\n\t\t\t},\n\t\t}\n\t},\n\n\t{\n\t\tpath: prefix + \"/isLogin\",\n\t\tmethod: \"get\",\n\t\taction: \"isLogin\",\n\t},\n\t];\n\n\treturn routes;\n}\n\nexport default new User();\n\n\n\n// WEBPACK FOOTER //\n// ./server/controllers/user.js","import _validate from \"./validate.js\";\n\n\nexport const validate = _validate;\n\nexport default {\n\tvalidate,\n}\n\n\n\n// WEBPACK FOOTER //\n// ./server/middlewares/index.js","import _ from 'lodash';\nimport joi from 'joi';\n\nimport {ERR_PARAMS} from \"../common/error.js\";\n\nexport const validate = (schema = {}) => {\n\tconst { opt = {} } = schema;\n\tconst options = _.defaultsDeep(opt, {\n    \tallowUnknown: true,\n  \t});\n  \treturn async (ctx, next) => {\n    \tconst defaultValidateKeys = ['body', 'query', 'params'];\n    \tconst needValidateKeys = _.intersection(defaultValidateKeys, Object.keys(schema));\n\n    \tconst errors = [];\n    \tneedValidateKeys.find((item) => {\n      \t\tconst toValidateObj = item === 'body' ? ctx.request.body : ctx[item];\n      \t\tconst result = joi.validate(toValidateObj, schema[item], options);\n      \t\tif (result.error) {\n        \t\terrors.push(result.error.details[0]);\n        \t\treturn true;\n      \t\t}\n      \t\t_.assignIn(toValidateObj, result.value);\n      \t\treturn false;\n    \t});\n\n    \tif (errors.length !== 0) {\n      \t\tconst msg = errors[0].message.replace(/\"/g, '');\n\t\t\tctx.body = ERR_PARAMS.setMessage(msg);\n\t\t\treturn;\n    \t}\n\n    \tawait next();\n  \t};\n};\n\nexport default validate;\n\n\n\n// WEBPACK FOOTER //\n// ./server/middlewares/validate.js","\nimport _User from \"./user.js\";\nimport _DataSource from \"./dataSource.js\";\n\nexport const User = _User;\nexport const DataSource = _DataSource;\n\nexport default {\n\tUser,\n\tDataSource,\n}\n\n\n\n// WEBPACK FOOTER //\n// ./server/models/index.js","\nexport default {\n\tapiUrlPrefix: \"/api/v0\",\n\tgitlabToken: \"18ayouuEsKRo_yM1P5eF\",\n\n\tsecret: \"keepwork\",\n\n\tdatabase: {\n\t\t//port:3306,\n\t\thost: '39.106.11.114',\n\t\ttype: \"mysql\",\n\t\tdatabase: \"keepwork\", // 数据库名\n\t\tusername: \"wuxiangan\",\n\t\tpassword: \"wuxiangan\", \n\t},\n}\n\n\n\n\n// WEBPACK FOOTER //\n// ./server/prod.config.js","module.exports = require(\"@koa/cors\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"@koa/cors\"\n// module id = 35\n// module chunks = 0","module.exports = require(\"axios\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"axios\"\n// module id = 36\n// module chunks = 0","module.exports = require(\"elasticsearch\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"elasticsearch\"\n// module id = 37\n// module chunks = 0","module.exports = require(\"humps\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"humps\"\n// module id = 38\n// module chunks = 0","module.exports = require(\"js-base64\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"js-base64\"\n// module id = 39\n// module chunks = 0","module.exports = require(\"js-yaml\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"js-yaml\"\n// module id = 40\n// module chunks = 0","module.exports = require(\"koa-body\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-body\"\n// module id = 41\n// module chunks = 0","module.exports = require(\"koa-jwt\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-jwt\"\n// module id = 42\n// module chunks = 0","module.exports = require(\"koa-router\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-router\"\n// module id = 43\n// module chunks = 0","module.exports = require(\"koa-static\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-static\"\n// module id = 44\n// module chunks = 0","module.exports = require(\"lodash.pick\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash.pick\"\n// module id = 45\n// module chunks = 0","module.exports = require(\"parse-link-header\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"parse-link-header\"\n// module id = 46\n// module chunks = 0","module.exports = require(\"path\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"path\"\n// module id = 47\n// module chunks = 0","module.exports = require(\"regenerator-runtime\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"regenerator-runtime\"\n// module id = 48\n// module chunks = 0","module.exports = require(\"webpack\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"webpack\"\n// module id = 49\n// module chunks = 0","import Koa from 'koa'\nimport { Nuxt, Builder } from 'nuxt'\n\nimport server from \"./server.js\";\nimport _config from \"./config.js\";\n\nasync function start () {\n  const app = new Koa()\n\n  // Import and Set Nuxt.js options\n  let config = require('../nuxt.config.js')\n  config.dev = !(app.env === 'production')\n\n  // Instantiate nuxt.js\n  const nuxt = new Nuxt(config)\n\n  // Build in development\n  if (config.dev) {\n    const builder = new Builder(nuxt)\n    await builder.build()\n  }\n\n  server(app);\n\n  app.use(async (ctx, next) => {\n    await next()\n    ctx.status = 200 // koa defaults to 404 when it sees that status is unset\n    return new Promise((resolve, reject) => {\n      ctx.res.on('close', resolve)\n      ctx.res.on('finish', resolve)\n\t  ctx.req.ctx = ctx;\n      nuxt.render(ctx.req, ctx.res, promise => {\n        // nuxt.render passes a rejected promise into callback on error.\n        promise.then(resolve).catch(reject)\n      })\n    })\n  })\n\n  const host = _config.host || '127.0.0.1'\n  const port = _config.port || 3000\n  app.listen(port, host)\n  console.log('Server listening on ' + host + ':' + port) // eslint-disable-line no-console\n}\n\nstart()\n\n\n\n// WEBPACK FOOTER //\n// ./server/index.js"],"sourceRoot":""}